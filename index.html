<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACCA TX (UK) FA2024 Ultimate Full Notes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* === 1. åŸºç¡€è®¾ç½® (è«å…°è¿ªÂ·æ™šéœä¸»é¢˜) === */
        :root {
            /* è«å…°è¿ªè‰²ç›˜ */
            --col-purple: #a29bfe;   /* CGTä¸»è‰² */
            --col-purple-lt: #dcd6f7;
            --col-green: #95e1d3;    /* IHTä¸»è‰² */
            --col-green-lt: #a8e6cf;
            --col-root: #34495e;
            --col-boss: #ffb7b2;     /* çŠç‘šç²‰ BOSS */
            
            --bg-color: #fdfbf7;     /* æš–ç±³ç™½èƒŒæ™¯ */
            --text-main: #2d3436;
            --text-sub: #636e72;
            --glass: rgba(255, 255, 255, 0.98);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; overflow: hidden; background-color: var(--bg-color); font-family: "Gill Sans", "Segoe UI", sans-serif; }
        #main { width: 100vw; height: 100vh; z-index: 1; }

        /* é¡¶éƒ¨æ  */
        .header {
            position: fixed; top: 0; left: 0; right: 0; height: 50px;
            background: rgba(253, 251, 247, 0.85); backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 10;
            display: flex; align-items: center; justify-content: center;
        }
        .header h1 { font-size: 16px; color: var(--text-main); font-weight: 800; letter-spacing: 1px; margin: 0; }

        /* === 2. è¯¦æƒ…é¢æ¿ (PC/Mobile å®Œç¾é€‚é…) === */
        .mask {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(45, 52, 54, 0.2); z-index: 99; 
            display: none; opacity: 0; transition: opacity 0.3s;
        }
        .mask.active { display: block; opacity: 1; }

        .sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--glass); z-index: 100;
            box-shadow: 0 -10px 60px rgba(0,0,0,0.1);
            border-radius: 24px 24px 0 0;
            display: flex; flex-direction: column;
            transform: translateY(110%); 
            transition: transform 0.35s cubic-bezier(0.19, 1, 0.22, 1);
            
            /* ğŸ“± ç§»åŠ¨ç«¯é»˜è®¤é«˜åº¦ */
            max-height: 85vh; 
        }

        /* ğŸ’» ç”µè„‘ç«¯é€‚é…ï¼šé™åˆ¶å®½åº¦ï¼Œå±…ä¸­æ˜¾ç¤º */
        @media (min-width: 768px) {
            .sheet {
                left: 50%; transform: translateX(-50%) translateY(110%);
                width: 700px; /* é»„é‡‘é˜…è¯»å®½åº¦ */
                max-height: 90vh;
                border: 1px solid #eee;
            }
            .sheet.active { transform: translateX(-50%) translateY(0); }
        }
        /* ğŸ“± ç§»åŠ¨ç«¯æ¿€æ´»çŠ¶æ€ */
        @media (max-width: 767px) {
            .sheet.active { transform: translateY(0); }
        }

        /* å¤´éƒ¨ */
        .sheet-head {
            padding: 20px 30px; border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .sheet-title { font-size: 20px; font-weight: 700; color: var(--text-main); margin: 0; display: flex; align-items: center; }
        .close-btn { font-size: 26px; color: #b2bec3; cursor: pointer; transition: color 0.2s; }
        .close-btn:hover { color: var(--col-boss); }

        /* å†…å®¹åŒº */
        .sheet-body { padding: 0 30px 40px 30px; overflow-y: auto; -webkit-overflow-scrolling: touch; flex: 1; }

        /* === 3. å†…å®¹ç»„ä»¶ (ç¬”è®°è¿˜åŸ) === */
        
        /* ç« èŠ‚æ ‡é¢˜ */
        .section-title {
            font-size: 13px; font-weight: 800; color: var(--text-main); 
            margin: 25px 0 12px 0; text-transform: uppercase; letter-spacing: 1px;
            display: flex; align-items: center;
        }
        .section-title::before { content:''; width:4px; height:14px; background:#ccc; margin-right:8px; border-radius:2px; }

        /* æ–‡æœ¬ */
        .text-content { font-size: 15px; line-height: 1.7; color: #555; text-align: justify; }
        .text-content b { color: #2c3e50; }
        .text-content ul { padding-left: 18px; margin: 8px 0; }
        .text-content li { margin-bottom: 6px; }

        /* è§„åˆ™å¡ç‰‡ */
        .rule-card {
            background: #fff; border: 1px solid #f0f0f0; border-radius: 10px;
            padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        
        /* æ¡ˆä¾‹ç›’å­ */
        .case-box {
            background: #fffbf5; border-left: 4px solid var(--col-boss); border-radius: 0 8px 8px 0;
            padding: 15px; margin-top: 20px;
        }
        .case-header { font-weight: 700; color: #d35400; font-size: 14px; margin-bottom: 8px; }
        .case-body { font-size: 14px; color: #444; white-space: pre-wrap; font-family: -apple-system, sans-serif; line-height: 1.6; }

        /* Proforma / ç®—å¼ */
        .formula-box {
            background: #f4f8fb; border: 1px solid #e1eef6; color: #2980b9;
            padding: 10px; border-radius: 6px; font-family: "Menlo", monospace; font-size: 13px; margin: 5px 0;
        }

        /* æŠ˜å è§£æ */
        details { margin-top: 10px; border-top: 1px dashed #e0e0e0; padding-top: 10px; }
        summary { font-size: 13px; font-weight: 600; color: #7f8c8d; cursor: pointer; list-style:none; display:flex; justify-content:space-between; }
        summary::after { content: 'â–¼ è§£æ'; color: #aaa; }
        details[open] summary::after { content: 'â–² æ”¶èµ·'; }
        .ans { margin-top:10px; padding:15px; background:#f9f9f9; border-radius:6px; font-family:monospace; font-size:13px; line-height:1.6; white-space: pre-wrap; color: #333; }

        /* è¡¨æ ¼ */
        .tax-table { width: 100%; border-collapse: collapse; font-size: 13px; margin: 10px 0; background:#fff; }
        .tax-table th { background: #f4f4f4; padding: 8px; text-align: left; border:1px solid #ddd; color:#333; font-weight:700; }
        .tax-table td { border: 1px solid #ddd; padding: 8px; color:#555; vertical-align: top; }

        /* é«˜äº® */
        .hl-red { color: #e74c3c; font-weight: bold; }
        .hl-bg { background: #e8f6f3; padding: 2px 4px; border-radius: 3px; color: #16a085; font-weight: bold; }

    </style>
</head>
<body>

    <div class="header">
        <h1>TX (UK) Full Notes</h1>
    </div>

    <div id="main"></div>

    <div class="mask" id="mask" onclick="closeSheet()"></div>
    <div class="sheet" id="sheet">
        <div class="sheet-head">
            <div class="sheet-title" id="sheetTitle">Topic</div>
            <div class="close-btn" onclick="closeSheet()">Ã—</div>
        </div>
        <div class="sheet-body" id="sheetContent"></div>
    </div>

    <script type="text/javascript">
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom, null, {renderer: 'canvas'});

        // ================= é…è‰²å®šä¹‰ =================
        const c = {
            iht: '#95e1d3',    // IHT ä¸»è‰²
            iht_sub: '#dcedc1',
            cgt: '#a29bfe',    // CGT ä¸»è‰²
            cgt_sub: '#dcd6f7',
            root: '#34495e',
            boss: '#ffb7b2'
        };

        // ================= å®Œæ•´ç¬”è®°æ•°æ®åº“ (100% è¿˜åŸ) =================
        const data = [
            // --- Root ---
            { id: '0', name: 'ACCA TX\n(UK)', category: 'ROOT', symbolSize: 55, itemStyle: { color: c.root }, info: { def: 'FA2024 å®Œæ•´ç¬”è®° (IHT + CGT)ã€‚<br>ç‚¹å‡»åˆ†æ”¯æŸ¥çœ‹è¯¦ç»†è®²ä¹‰ã€‚' } },

            // ==================== IHT æ¨¡å— (Legacy Data) ====================
            {
                id: 'iht_1', name: 'IHT\nåŸç†', category: 'IHT', symbolSize: 40, itemStyle: { color: c.iht },
                info: {
                    title: '1. æ ¸å¿ƒæ¦‚å¿µä¸ç¨ç‡ (Basic Principles)',
                    html: `
                        <div class="section-title" style="border-color:${c.iht}">å¾ç¨åŸºç¡€</div>
                        <div class="text-content">IHT æ˜¯åŸºäº <b>ä»·å€¼è½¬ç§» (Transfer of Value)</b>ï¼Œå³æèµ å¯¼è‡´æèµ è€…è´¢å¯Œå‡å°‘çš„é‡‘é¢ (Diminution in value)ã€‚</div>
                        <div class="section-title" style="border-color:${c.iht}">çº³ç¨äººèº«ä»½</div>
                        <div class="text-content">
                            <ul>
                                <li><b>UK Domiciled (è‹±å›½å±…ç±):</b> å¯¹å…¨çƒèµ„äº§å¾ç¨ã€‚</li>
                                <li><b>Non-UK Domiciled (éè‹±å›½å±…ç±):</b> ä»…å¯¹è‹±å›½èµ„äº§å¾ç¨ã€‚</li>
                            </ul>
                        </div>
                        <div class="section-title" style="border-color:${c.iht}">å…³é”®ç¨ç‡ (2025/26 ç¨ç‡è¡¨)</div>
                        <div class="rule-card">
                            <b>Nil Rate Band (NRB, æ™®é€šé›¶ç¨ç‡å¸¦):</b> Â£325,000ã€‚<br>
                            <b>Residence Nil Rate Band (RNRB, å±…ä½é›¶ç¨ç‡å¸¦):</b> Â£175,000ã€‚<br>
                            <b>Death Rate (æ­»äº¡ç¨ç‡):</b> 40%ã€‚<br>
                            <b>Lifetime Rate (ç”Ÿå‰ç¨ç‡):</b> 20% (å—èµ äººä»˜) æˆ– 25% (æèµ äººä»˜)ã€‚
                        </div>
                    `
                }
            },
            {
                id: 'iht_2', name: 'Lifetime\nç”Ÿå‰è½¬ç§»', category: 'IHT', symbolSize: 35, itemStyle: { color: c.iht_sub },
                info: {
                    title: '2. ç”Ÿå‰è½¬ç§» (Lifetime Transfers)',
                    html: `
                        <div class="text-content">ç”Ÿå‰çš„ç¤¼ç‰©åˆ†ä¸ºä¸‰ç±»ï¼Œå¤„ç†æ–¹å¼æˆªç„¶ä¸åŒã€‚</div>

                        <div class="section-title" style="border-color:${c.iht}">A. è±å…è½¬ç§» (Exempt Transfers)</div>
                        <div class="text-content">
                            è¿™äº›ç¤¼ç‰©æ— è®ºç”Ÿå‰è¿˜æ˜¯æ­»åï¼Œæ°¸è¿œä¸å¾ç¨ã€‚
                            <ul>
                                <li><b>Spouse/Civil Partner (é…å¶):</b> æ— é™é¢è±å…ã€‚</li>
                                <li><b>Annual Exemption (AE, å¹´åº¦è±å…):</b> æ¯å¹´ Â£3,000ã€‚å½“å¹´æ²¡ç”¨å®Œå¯å‘åç»“è½¬ 1å¹´ (FIFOåŸåˆ™ï¼šå…ˆç”¨ä»Šå¹´çš„ï¼Œå†ç”¨å»å¹´çš„)ã€‚</li>
                                <li><b>Small Gifts (å°é¢ç¤¼ç‰©):</b> æ¯ä½å—èµ äººæ¯å¹´ Â£250 (è‹¥è¶…è¿‡åˆ™å…¨é¢ä¸è±å…)ã€‚</li>
                                <li><b>Marriage Exemption (ç»“å©šç¤¼ç‰©):</b> çˆ¶æ¯é€ Â£5,000ï¼Œç¥–çˆ¶æ¯é€ Â£2,500ï¼Œå…¶ä»–äººé€ Â£1,000ã€‚</li>
                                <li><b>Normal expenditure out of income:</b> å¿…é¡»è¯æ˜æ˜¯ä¹ æƒ¯æ€§çš„ä¸”ä¸å½±å“ç”Ÿæ´»æ°´å¹³ã€‚</li>
                            </ul>
                        </div>
                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 1ï¼šç²¾æ‰“ç»†ç®—çš„çˆ·çˆ·</div>
                            <div class="case-body">æƒ…æ™¯ï¼š Grandpa åœ¨ 2024å¹´5æœˆé€ç»™å­™å­ Â£8,000 ç»“å©šç¤¼ç‰©ã€‚ä¸Šä¸€ç¨å¹´æœªåšèµ äºˆã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Transfer Value: Â£8,000
(-) Marriage Exemption: (Â£2,500) (ç¥–çˆ¶æ¯é¢åº¦)
(-) AE (Current Year): (Â£3,000)
(-) AE (Brought Forward): (Â£2,500) (ä¸Šä¸€å¹´ç»“è½¬)
= Chargeable Value: Â£0 (å®Œå…¨è±å…)</div>
                            </details>
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">B. æ½œåœ¨è±å…è½¬ç§» (PET)</div>
                        <div class="text-content">
                            <b>å®šä¹‰ï¼š</b>ä¸ªäººé€ç»™ <b>ä¸ªäºº</b> çš„ç¤¼ç‰©ã€‚<br>
                            <b>ç”Ÿå‰å¤„ç†ï¼š</b>ä¸äº¤ç¨ (No immediate tax)ã€‚<br>
                            <b>åæœï¼š</b><br>
                            â€¢ æ´»è¿‡ 7å¹´ -> å®Œå…¨è±å…ã€‚<br>
                            â€¢ 7å¹´å†… æ­»äº¡ -> å˜æˆ Chargeableï¼Œéœ€è¡¥äº¤æ­»äº¡ç¨ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">C. åº”ç¨ç”Ÿå‰è½¬ç§» (CLT)</div>
                        <div class="text-content">
                            <b>å®šä¹‰ï¼š</b>ä¸ªäººé€ç»™ <b>ä¿¡æ‰˜ (Trust)</b> çš„ç¤¼ç‰©ã€‚<br>
                            <b>ç”Ÿå‰å¤„ç†ï¼š</b>ç«‹å³äº¤ç¨ã€‚<br>
                            <b>è®¡ç®—ï¼š</b>(è½¬ç§»ä»·å€¼ - è±å…) - (å‰©ä½™ NRB)ã€‚<br>
                            <b>7å¹´ç´¯ç§¯åŸåˆ™ï¼š</b>è®¡ç®—å‰©ä½™ NRB æ—¶ï¼Œè¦æ‰£é™¤è¿™ç¬”ç¤¼ç‰© <b>ä¹‹å‰ 7 å¹´å†…</b> çš„æ‰€æœ‰ GCT (Gross Chargeable Transfers)ã€‚<br>
                            <b>ç¨ç‡ï¼š</b>è¶…å‡ºéƒ¨åˆ†äº¤ 20% (Trusteeä»˜) æˆ– 25% (Donorä»˜)ã€‚
                        </div>
                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 2ï¼šå¯Œè±ªçš„ä¿¡æ‰˜ (ç”Ÿå‰ç¨)</div>
                            <div class="case-body">æƒ…æ™¯ï¼š Mr. Rich å‘ä¿¡æ‰˜è½¬å…¥ Â£400,000 (CLT)ã€‚æ­¤å‰7å¹´å†…æ—  CLTï¼Œåªæœ‰ä¸€ä¸ª PET (PET ç”Ÿå‰ä¸å ç”¨ NRB)ã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Gross Chargeable Transfer: Â£400,000
Less NRB: (Â£325,000) (æ­¤å‰æ—  CLT)
Taxable Amount: Â£75,000
Lifetime Tax: Â£75,000 Ã— 20% = Â£15,000</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'iht_3', name: 'Death Tax\næ­»åè¿½æº¯', category: 'IHT', symbolSize: 35, itemStyle: { color: c.iht_sub },
                info: {
                    title: '3. æ­»äº¡æ—¶çš„é¢å¤–ç¨ (Death Tax on Lifetime Gifts)',
                    html: `
                        <div class="text-content">å½“æèµ äººåœ¨é€ç¤¼å 7å¹´å†…æ­»äº¡ï¼Œä¹‹å‰çš„ PET å’Œ CLT éœ€è¦æ‹‰å›æ¥é‡ç®—ä¸€æ¬¡ç¨ã€‚</div>

                        <div class="section-title" style="border-color:${c.iht}">è®¡ç®—æ­¥éª¤</div>
                        <div class="text-content">
                            1. <b>æŸ¥æ‰¾ï¼š</b>æ‰¾å‡ºæ­»å‰ 7 å¹´å†…çš„æ‰€æœ‰ PET å’Œ CLTã€‚<br>
                            2. <b>NRB æ‰£é™¤ï¼š</b>ä½¿ç”¨æ­»äº¡æ—¶çš„ NRB (Â£325,000)ï¼Œå‡å»è¯¥ç¤¼ç‰© <b>å†å¾€å‰æ¨ 7 å¹´</b> ç´¯ç§¯çš„ GCTã€‚<br>
                            3. <b>è®¡ç®—ç¨é¢ï¼š</b>å‰©ä½™éƒ¨åˆ† Ã— 40%ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">Taper Relief (é€’å‡å‡å…)</div>
                        <div class="text-content">
                            å¦‚æœåœ¨é€ç¤¼åæ´»å¾—å¤Ÿä¹…ï¼Œç¨é¢å¯ä»¥æ‰“æŠ˜ï¼š<br>
                            â€¢ 3-4å¹´: 8æŠ˜ (20% reduction)<br>
                            â€¢ 4-5å¹´: 6æŠ˜ (40% reduction)<br>
                            â€¢ 5-6å¹´: 4æŠ˜ (60% reduction)<br>
                            â€¢ 6-7å¹´: 2æŠ˜ (80% reduction)
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">Credit</div>
                        <div class="text-content">å¯¹äº CLTï¼Œå‡å»ç”Ÿå‰å·²ç»äº¤è¿‡çš„ 20% ç¨ (Lifetime Tax)ã€‚</div>

                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 3ï¼šä¸å¹¸çš„å¯Œè±ª (æ­»åè¿½æº¯)</div>
                            <div class="case-body">æƒ…æ™¯ï¼š æ¥æ¡ˆä¾‹2ï¼ŒMr. Rich åœ¨é€å‡º Â£100,000 PET çš„ 4.5 å¹´åå»ä¸–ã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Gross Value: Â£100,000
Available NRB: Â£325,000 (è¯¥ PET å‰ 7 å¹´æ— ç¤¼ç‰©)ã€‚
Tax Payable: Â£0 (åœ¨ NRB å†…ï¼Œä½†åƒæ‰äº† Â£100k é¢åº¦ï¼Œå½±å“åç»­è®¡ç®—)ã€‚</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'iht_4', name: 'Estate\næ­»äº¡é—äº§', category: 'IHT', symbolSize: 35, itemStyle: { color: c.iht_sub },
                info: {
                    title: '4. æ­»äº¡é—äº§ç¨ (Death Estate)',
                    html: `
                        <div class="text-content">è¿™æ˜¯å¯¹æ­»è€…å»ä¸–æ—¶æ‹¥æœ‰çš„æ‰€æœ‰èµ„äº§å¾ç¨ã€‚</div>

                        <div class="section-title" style="border-color:${c.iht}">A. é—äº§ä¼°å€¼ (Valuation)</div>
                        <div class="text-content">
                            èµ„äº§æŒ‰ <b>å¸‚ä»· (Market/Probate Value)</b> è®¡ç®—ã€‚<br>
                            <b>å¯æ‰£é™¤ (Deductions)ï¼š</b>å€ºåŠ¡ (Debts)ã€æœªä»˜ç¨æ¬¾ã€ä¸§è‘¬è´¹ (Funeral expenses)ã€‚<br>
                            <b>è±å…ï¼š</b>ç•™ç»™é…å¶ (Spouse) çš„é—äº§å®Œå…¨å…ç¨ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">B. å±…ä½é›¶ç¨ç‡å¸¦ (RNRB)</div>
                        <div class="text-content">
                            <b>é‡‘é¢ï¼š</b>Â£175,000ã€‚<br>
                            <b>æ¡ä»¶ï¼š</b>é—äº§ä¸­åŒ…å« <b>ä¸»è¦å±…æ‰€ (Main Residence)</b>ï¼Œä¸”ç•™ç»™äº† <b>ç›´ç³»åä»£ (Direct Descendants)</b> (å­å¥³ã€å­™å­å¥³)ã€‚<br>
                            <b>æ³¨æ„ï¼š</b>å¦‚æœæˆ¿äº§å‡€å€¼ < Â£175,000ï¼ŒRNRB é™åˆ¶ä¸ºæˆ¿äº§å‡€å€¼ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">C. NRB çš„è½¬ç§»</div>
                        <div class="text-content">å¦‚æœé…å¶å…ˆå»ä¸–ä¸”æ²¡ç”¨å®Œ NRB æˆ– RNRBï¼Œæœªä½¿ç”¨çš„ <b>ç™¾åˆ†æ¯”</b> å¯ä»¥è½¬ç§»ç»™åå»ä¸–çš„é…å¶ã€‚</div>

                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 4ï¼šæœ€åçš„é—äº§</div>
                            <div class="case-body">æƒ…æ™¯ï¼š Mrs. White å»ä¸–ï¼Œç•™ç»™å­™å­ä¸€å¥—æˆ¿ (Â£400k) å’Œå…¶ä»–èµ„äº§ (Â£200k)ã€‚æ— ç”Ÿå‰èµ äºˆã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Chargeable Estate: Â£600,000
Less RNRB: (Â£175,000) (ç¬¦åˆæ¡ä»¶)
Less NRB: (Â£325,000)
Taxable: Â£100,000
Tax: Â£100,000 Ã— 40% = Â£40,000</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'iht_5', name: 'Proforma\nè®¡ç®—æ¨¡æ¿', category: 'IHT', symbolSize: 35, itemStyle: { color: c.iht_sub },
                info: {
                    title: '5. å¿…èƒŒè®¡ç®—æ¨¡æ¿ (Proforma)',
                    html: `
                        <div class="section-title" style="border-color:${c.iht}">Step 1: Lifetime Tax (ç”Ÿå‰ç¨ - ä»… CLT)</div>
                        <div class="proforma">Transfer Value
(Less: Exemptions - AE, Marriage)
= Chargeable Transfer
(Less: Available NRB - look back 7 years for GCTs)
= Taxable Amount x 20% (Trustee pays) / 25% (Donor pays)</div>

                        <div class="section-title" style="border-color:${c.iht}">Step 2: Death Tax on Lifetime Gifts</div>
                        <div class="proforma">Gross Chargeable Value (Value at date of gift)
(Less: NRB at death - look back 7 years from the gift)
= Taxable x 40%
(Less: Taper Relief)
(Less: Lifetime tax paid - only for CLT)</div>

                        <div class="section-title" style="border-color:${c.iht}">Step 3: Death Estate (é—äº§ç¨)</div>
                        <div class="proforma">Total Assets (Probate Value)
(Less: Debts & Funeral)
(Less: Exempt Legacies to Spouse)
= Chargeable Estate
(Less: RNRB - max Â£175k)
(Less: Remaining NRB - Â£325k minus GCTs in last 7 years)
= Taxable Estate x 40%</div>
                    `
                }
            },
            {
                id: 'iht_boss', name: 'IHT BOSS\nç»¼åˆå¤§é¢˜', category: 'IHT', symbolSize: 45, itemStyle: { color: c.boss },
                info: {
                    title: 'ğŸ‘¹ ç»ˆæ BOSS æˆ˜ï¼šç»¼åˆå¤§é¢˜',
                    html: `
                        <div class="case-box" style="border-color:${c.boss}; background:#fffbf0;">
                            <div class="case-header" style="color:#e67e22">Mr. Bond ç»¼åˆé¢˜</div>
                            <div class="case-body"><b>èƒŒæ™¯ï¼š</b> Mr. Bond (UK Domiciled) äº 2026å¹´3æœˆ20æ—¥ å»ä¸–ã€‚<br>1. 2019å¹´8æœˆ1æ—¥ (CLT): å‘ä¿¡æ‰˜è½¬å…¥ Â£280,000 (Gross)ã€‚<br>2. 2021å¹´10æœˆ1æ—¥ (PET): é€ç»™å¥³å„¿ Â£150,000ã€‚<br>3. æ­»äº¡é—äº§ (Death Estate): è‡ªä½æˆ¿å±‹ Â£500,000 (ç»™å„¿å­)ï¼Œè‚¡ç¥¨ Â£300,000ï¼Œå€ºåŠ¡ Â£20,000ï¼Œä¸§è‘¬è´¹ Â£5,000ã€‚</div>
                            
                            <details open>
                                <summary>æŸ¥çœ‹è¯¦ç»†è§£æ</summary>
                                <div class="ans"><b>ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥ç”Ÿå‰èµ äºˆå¯¹ NRB çš„å ç”¨ (7å¹´ç´¯ç§¯)</b>
1. CLT (2019å¹´8æœˆ): ä»·å€¼ Â£280,000ã€‚
   è·ç¦»æ­»äº¡ 6-7 å¹´ï¼Œå ç”¨ NRBã€‚

2. PET (2021å¹´10æœˆ): ä»·å€¼ Â£150,000ã€‚
   è·ç¦»æ­»äº¡ < 7 å¹´ï¼Œå˜æˆ Chargeableï¼Œå ç”¨ NRBã€‚

<b>NRB å ç”¨è®¡ç®—:</b>
CLT ç”¨æ‰äº†ï¼šÂ£280,000
å‰©ä½™ NRBï¼šÂ£325,000 - Â£280,000 = Â£45,000
PET ç”¨æ‰äº†ï¼šÂ£150,000 (PET åƒæ‰äº†å‰©ä¸‹çš„ Â£45,000ï¼Œå¹¶æº¢å‡ºã€‚PET è‡ªå·±è¦å»äº¤æ­»äº¡ç¨ï¼Œä½†å¯¹é—äº§ç¨è®¡ç®—æ¥è¯´ï¼Œå…³é”®æ˜¯ <b>NRB å·²å½’é›¶</b>)ã€‚

<b>ç¬¬äºŒæ­¥ï¼šè®¡ç®—é—äº§ç¨ (Death Estate Tax)</b>
<table class="tax-table">
<tr><th>é¡¹ç›®</th><th>é‡‘é¢ (Â£)</th><th>è¯´æ˜</th></tr>
<tr><td>Total Assets</td><td>800,000</td><td>(Â£500k æˆ¿ + Â£300k è‚¡)</td></tr>
<tr><td>Less: Liabilities</td><td>(25,000)</td><td>(Â£20k å€º + Â£5k ä¸§è‘¬)</td></tr>
<tr><td><b>Net Chargeable Estate</b></td><td><b>775,000</b></td><td></td></tr>
<tr><td>Less: RNRB</td><td>(175,000)</td><td>æœ‰è‡ªä½æˆ¿ä¸”ç•™ç»™å„¿å­ï¼Œå…¨é¢æ‰£é™¤</td></tr>
<tr><td>Less: Remaining NRB</td><td>(0)</td><td><b>æ ¸å¿ƒè€ƒç‚¹ï¼š</b> ç”Ÿå‰ç¤¼ç‰©å·²å°† Â£325k è€—å°½</td></tr>
<tr><td><b>Taxable Estate</b></td><td><b>600,000</b></td><td></td></tr>
<tr><td><b>Tax Payable</b></td><td><b>240,000</b></td><td>Â£600,000 Ã— 40%</td></tr>
</table>
<div style="margin-top:10px;font-weight:bold;color:#2c3e50">ğŸ¯ æœ€ç»ˆç­”æ¡ˆï¼š é—äº§ç¨ (IHT) ä¸º Â£240,000ã€‚</div></div>
                            </details>
                        </div>
                    `
                }
            },

            // ==================== CGT æ¨¡å— (Full Content) ====================
            {
                id: 'cgt_1', name: 'CGT\næ ¸å¿ƒæ¦‚å¿µ', category: 'CGT', symbolSize: 40, itemStyle: { color: c.cgt },
                info: {
                    title: '1. æ ¸å¿ƒæ¦‚å¿µä¸ç¨ç‡ (Basic Principles)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">å¾ç¨åŸºç¡€</div>
                        <div class="text-content">å¾ç¨å¯¹è±¡ï¼šä¸ªäººåœ¨çº³ç¨å¹´åº¦å†…å¤„ç½®èµ„äº§äº§ç”Ÿçš„ <b>åˆ©å¾— (Profit)</b>ã€‚<br>è®¡ç®—åŸºç¡€ï¼šåŸºäº <b>Taxable Income (åº”ç¨æ”¶å…¥)</b> æ¥ç¡®å®šç¨ç‡ã€‚CGT æ˜¯â€œé¡¶â€åœ¨ Income Tax ä¹‹ä¸Šçš„ã€‚</div>

                        <div class="section-title" style="border-color:${c.cgt}">å…³é”®ç¨ç‡ (2025/26)</div>
                        <div class="rule-card">
                            <div class="text-content">
                                <ul>
                                    <li><b>å¹´åº¦è±å… (AEA):</b> <span class="hl-red">Â£3,000</span> (ç™½ç»™ï¼Œä¸äº¤ç¨)ã€‚</li>
                                    <li><b>æ™®é€šèµ„äº§ (Normal Rates):</b><br>- Basic Band: 10%<br>- Higher/Additional Band: 20%</li>
                                    <li><b>ä½å®…æˆ¿äº§ (Residential Property):</b><br>- Basic Band: 18%<br>- Higher/Additional Band: <span class="hl-red">24%</span> (FA24æ–°è§„)ã€‚</li>
                                    <li><b>BADR / Investors' Relief:</b> æ— è®ºæ”¶å…¥å¤šå°‘ï¼Œä¸€å¾‹ 10%ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    `
                }
            },
            {
                id: 'cgt_2', name: '2. Compute\nè®¡ç®—æ¡†æ¶', category: 'CGT', symbolSize: 35, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '2. åŸºç¡€è®¡ç®—æ¡†æ¶ (General Computation)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">A. è®¡ç®—æ¨¡æ¿ (Proforma)</div>
                        <div class="proforma">Disposal Proceeds (å¤„ç½®æ‰€å¾— - å”®ä»·/MV)
(Less: Incidental costs of disposal - é”€å”®è´¹ç”¨)
= Net Proceeds (å‡€å”®ä»·)
(Less: Allowable Cost - ä¹°å…¥ä»·+è´¹ç”¨)
(Less: Enhancement Expenditure - å¢å€¼æ”¯å‡º)
= Chargeable Gain (åº”ç¨åˆ©å¾—)</div>

                        <div class="section-title" style="border-color:${c.cgt}">B. æ±‡æ€»ä¸çº³ç¨ (Tax Liability)</div>
                        <div class="text-content">
                            1. æ±‡æ€»æ‰€æœ‰ Gainsã€‚<br>
                            2. <b>å‡å» Current Year Losses (å½“å¹´äºæŸ):</b> å¿…é¡»å…¨é¢æŠµæ‰£ï¼Œä¸èƒ½ä¿ç•™ã€‚<br>
                            3. <b>å‡å» Brought Forward Losses (ç»“è½¬äºæŸ):</b> åªå‡åˆ° Net Gains = AEA (Â£3,000) ä¸ºæ­¢ï¼Œå‰©ä¸‹çš„ç»§ç»­å‘åç»“è½¬ (ä¸è¦æµªè´¹ AEA)ã€‚<br>
                            4. <b>å‡å» AEA (Â£3,000):</b> æ€»æ˜¯ä¼˜å…ˆæŠµæ‰£ç¨ç‡æœ€é«˜çš„ (å¦‚æˆ¿äº§ 24%)ã€‚<br>
                            5. <b>å‰©ä½™éƒ¨åˆ† (Taxable Gains):</b> æ ¹æ® Income Tax å‰©ä½™ Band åˆ†æ®µè®¡ç®—ã€‚
                        </div>

                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 1ï¼šæ™®é€šèµ„äº§ vs æˆ¿äº§</div>
                            <div class="case-body">æƒ…æ™¯ï¼š Jack æ˜¯ Higher Rate Taxpayerã€‚ä»–åœ¨ 2025/26 å–äº†ä¸€å¹…ç”»èµšäº† Â£10,000ï¼Œå–äº†ä¸€å¥—æŠ•èµ„æˆ¿äº§èµšäº† Â£20,000ã€‚æ— äºæŸã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Taxable Gains: (Â£10k + Â£20k) - Â£3,000 (AEA) = Â£27,000ã€‚

å¦‚ä½•åˆ†é… AEAï¼Ÿ æ€»æ˜¯ä¼˜å…ˆæŠµæ‰£ç¨ç‡æœ€é«˜çš„ï¼(è¿™é‡Œæ˜¯æˆ¿äº§ 24% > ç”» 20%)ã€‚
æœ€ä¼˜è§£ï¼š AEA æŠµæ¶ˆæˆ¿äº§åˆ©å¾—ã€‚

Tax Payable:
ç”» (Â£10,000) x 20% = Â£2,000
æˆ¿äº§ (Â£20,000 - Â£3,000) x 24% = Â£4,080
Total = Â£6,080ã€‚</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'cgt_3', name: '3. Assets\nç‰¹æ®Šèµ„äº§', category: 'CGT', symbolSize: 35, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '3. èµ„äº§å¤„ç½®çš„ç‰¹æ®Šè§„åˆ™ (Special Rules)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">A. äº¤æ˜“å¯¹è±¡ç‰¹æ®Šæ€§</div>
                        <div class="text-content">
                            <b>Connected Persons (å…³è”æ–¹):</b> å¿…é¡»ç”¨ Market Value æ›¿ä»£å®é™…å”®ä»·ã€‚äºæŸåªèƒ½æŠµæ‰£åŒä¸€ä¸ªäººã€‚<br>
                            <b>Spouses/Civil Partners:</b> No Gain / No Lossã€‚å—èµ äººç»§æ‰¿åŸå§‹æˆæœ¬ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.cgt}">B. éƒ¨åˆ†å¤„ç½® (Part Disposals)</div>
                        <div class="text-content">
                            åœºæ™¯: ä¹°äº†ä¸€å¤§å—åœ°ï¼Œåªå–äº†å…¶ä¸­ä¸€åŠã€‚<br>
                            å…¬å¼: <span class="hl-bg">Allowable Cost = Original Cost Ã— A / (A + B)</span><br>
                            A = Gross Proceeds (å–å‡ºå”®ä»·)ï¼ŒB = Market Value of Remainder (å‰©ä½™å¸‚å€¼)ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.cgt}">C. åŠ¨äº§ (Chattels) - Â£6k è§„åˆ™</div>
                        <div class="text-content">
                            <ul>
                                <li><b>Wasting (<50yr):</b> Exempt (å¦‚èµ›é©¬ã€æ¸¸è‰‡)ã€‚ä¾‹å¤–: æ›¾ç”³è¯· Capital Allowances çš„æœºå™¨ä¸è±å…ã€‚</li>
                                <li><b>Non-wasting (>50yr):</b> (å¦‚å¤è‘£)<br>
                                    - ä¹°å– < Â£6k: Exemptã€‚<br>
                                    - ä¹°å– > Â£6k: Normalã€‚<br>
                                    - ä¹° < 6k, å– > 6k (Marginal Relief):<br>
                                    Gain é™åˆ¶ä¸º: 5/3 Ã— (Gross Proceeds - 6,000)ã€‚å–å°å€¼ã€‚<br>
                                    - ä¹° > 6k, å– < 6k (Loss Relief):<br>
                                    Deemed Proceeds = Â£6,000ã€‚Loss = Â£6,000 - Costã€‚
                                </li>
                            </ul>
                        </div>
                        
                        <div class="section-title" style="border-color:${c.cgt}">D. èµ„äº§æŸæ¯ (Lost/Destroyed)</div>
                        <div class="text-content">
                            è§†ä¸ºâ€œå‡ºå”®â€ï¼ŒProceeds = ä¿é™©èµ”æ¬¾ã€‚<br>
                            <b>Rollover:</b> å¦‚åœ¨ 12ä¸ªæœˆå†…é‡ç½®ï¼ŒGain å¯ä»æ–°èµ„äº§æˆæœ¬ä¸­æ‰£é™¤ã€‚<br>
                            æ³¨æ„: å¦‚æœ Cash Retained (èµ”æ¬¾æ²¡èŠ±å®Œ)ï¼Œå¯¹åº” Gain é©¬ä¸Šäº¤ç¨ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.cgt}">E. è‚¡ç¥¨ (Shares) - åŒ¹é…è§„åˆ™</div>
                        <div class="text-content">
                            <b>Matching Rules (ä¸ªäºº):</b><br>
                            1. Same Day: å½“å¤©ä¹°å…¥ã€‚<br>
                            2. Next 30 Days: æœªæ¥30å¤©å†…ä¹°å…¥ (é˜²æ­¢æ´—å”®)ã€‚<br>
                            3. Share Pool: å‰©ä¸‹è¿›æ± å­ï¼Œç®—å¹³å‡æˆæœ¬ (Average Cost)ã€‚<br>
                            <b>Bonus Issue:</b> å¢åŠ æ•°é‡ï¼Œæˆæœ¬ä¸å˜ã€‚<br>
                            <b>Rights Issue:</b> å¢åŠ æ•°é‡ï¼Œå¢åŠ æˆæœ¬ã€‚
                        </div>
                        <div class="proforma">Share Pool Calculation (è‚¡ç¥¨æ± æ¨¡æ¿):
|           | Number | Cost (Â£) |
| Balance b/f | X | X |
| (+) Purchase | X | X |
| (+) Rights  | X | X |
| (-) Disposal | (X) | (X) (Avg) |
| Balance c/f | X | X |</div>
                    `
                }
            },
            {
                id: 'cgt_4', name: '4. Reliefs\næ ¸å¿ƒå‡å…', category: 'CGT', symbolSize: 35, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '4. æ ¸å¿ƒå‡å… (Key Reliefs)',
                    html: `
                        <div class="text-content">Section C æ‹¿åˆ†ä¹‹ç‹ - å¿…é¡»èƒŒè¯µæ¡ä»¶ã€‚</div>
                        <table class="tax-table">
                            <tr><th>Relief</th><th>é€‚ç”¨å¯¹è±¡</th><th>æ•ˆæœ</th><th>æ ¸å¿ƒæ¡ä»¶</th></tr>
                            <tr><td><b>BADR</b></td><td>ä¸ªäºº</td><td>10% Rate<br>Limit Â£1m</td><td>1. å–ç”Ÿæ„(Sole/Partner >2yr)<br>2. å–è‚¡ä»½(5%+Emp >2yr)</td></tr>
                            <tr><td><b>Investors</b></td><td>ä¸ªäºº</td><td>10% Rate<br>Limit Â£10m</td><td>æœªä¸Šå¸‚äº¤æ˜“å…¬å¸; æ–°è‚¡; >3å¹´; éå‘˜å·¥ã€‚</td></tr>
                            <tr><td><b>Rollover</b></td><td>ä¸ªäºº/å…¬å¸</td><td>Gain æ¨è¿Ÿ</td><td>å–æ—§ä¹°æ–° (Qualifying Assets)<br>çª—å£: -1yr ~ +3yr<br>å¿…é¡»ç”¨äºç”Ÿæ„ã€‚</td></tr>
                            <tr><td><b>Gift</b></td><td>ä¸ªäºº</td><td>Gain è½¬ç§»</td><td>å•†ä¸šèµ„äº§; åŒæ–¹è”åˆç”³è¯·ã€‚</td></tr>
                            <tr><td><b>PPR</b></td><td>ä¸ªäºº</td><td>Exempt</td><td>è‡ªä½æˆ¿; Last 9mo deemed; ç¼ºå¸­å‰åéœ€å®é™…å±…ä½ã€‚</td></tr>
                        </table>
                    `
                }
            },
            {
                id: 'cgt_boss', name: 'CGT BOSS\nç»¼åˆå¤§é¢˜', category: 'CGT', symbolSize: 45, itemStyle: { color: c.boss },
                info: {
                    title: 'ğŸ‘¹ ç»ˆæ BOSS æˆ˜ï¼šç»¼åˆå¤§é¢˜',
                    html: `
                        <div class="case-box" style="border-color:${c.boss}; background:#fffbf0;">
                            <div class="case-header" style="color:#e67e22">Mr. Lucky ç»¼åˆé¢˜</div>
                            <div class="case-body"><b>èƒŒæ™¯ï¼š</b> Mr. Lucky (Higher Rate Taxpayer) åœ¨ 2025/26 ç¨å¹´ è¿›è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š<br>1. å–å¤è‘£èŠ±ç“¶ (Chattel): å–å¾— Â£8,000ï¼Œä¹°å…¥ä»· Â£4,000ã€‚<br>2. å–å…¬å¸ (Business): ä»–ç»è¥äº† 10 å¹´çš„å’–å•¡åº—å–äº†ï¼Œèµšäº† Â£200,000ã€‚ä»–ä»¥å‰æ²¡ç”¨è¿‡ BADRã€‚<br>3. å–è‚¡ç¥¨ (Shares): å–äº† 1,000 è‚¡ A Plcã€‚2010å¹´ä¹° 500 è‚¡ Â£1,000ï¼›2020å¹´ä¹° 1,000 è‚¡ Â£3,000ã€‚å–å‡ºä»· Â£5/è‚¡ã€‚<br>4. å…¶ä»–: ä¸Šä¸€å¹´ç»“è½¬äºæŸ (B/f Loss) Â£500ã€‚<br><b>ä»»åŠ¡:</b> è®¡ç®— Mr. Lucky 2025/26 éœ€è¦ç¼´çº³çš„ CGT æ€»é¢ã€‚</div>
                            
                            <details open>
                                <summary>æŸ¥çœ‹è¯¦ç»†è§£æ</summary>
                                <div class="ans"><b>1. å¤è‘£èŠ±ç“¶ (Chattel):</b>
ä¹° < Â£6,000ï¼Œå– > Â£6,000ã€‚é€‚ç”¨ Marginal Reliefã€‚
Normal Gain: Â£8,000 - Â£4,000 = Â£4,000ã€‚
Restricted Gain: 5/3 Ã— (Â£8,000 - 6,000) = Â£3,333ã€‚
å–è¾ƒå°å€¼ï¼š<b>Chargeable Gain = Â£3,333</b>ã€‚

<b>2. å’–å•¡åº— (Business):</b>
æ»¡è¶³ BADR æ¡ä»¶ (ç»è¥ > 2å¹´)ã€‚
Gain: Â£200,000ã€‚
ç¨ç‡ï¼š<b>10%</b> (BADR ä¼˜å…ˆ)ã€‚

<b>3. è‚¡ç¥¨ (Shares):</b>
Share Pool Cost: Â£1,000 + Â£3,000 = Â£4,000 (å…± 1,500 è‚¡)ã€‚å¹³å‡æˆæœ¬ = Â£2.67/è‚¡ã€‚
Disposal Cost: 1,000 è‚¡ Ã— Â£2.67 = Â£2,667ã€‚
Proceeds: 1,000 è‚¡ Ã— Â£5 = Â£5,000ã€‚
Gain: Â£5,000 - Â£2,667 = <b>Â£2,333</b>ã€‚

<b>4. æ±‡æ€»è®¡ç®— (CGT Computation):</b>
<table class="tax-table">
<tr><th>Item</th><th>Gain (Â£)</th><th>Rate</th><th>Tax (Â£)</th></tr>
<tr><td>Total Gains</td><td>205,666</td><td></td><td>(3,333 + 200,000 + 2,333)</td></tr>
<tr><td>(-) B/f Loss</td><td>(500)</td><td></td><td></td></tr>
<tr><td>(-) AEA</td><td>(3,000)</td><td></td><td></td></tr>
<tr><td><b>= Taxable Gains</b></td><td><b>202,166</b></td><td></td><td></td></tr>
<tr><td colspan="4"><b>Tax Calculation:</b></td></tr>
<tr><td>Business (BADR)</td><td>200,000</td><td>10%</td><td>20,000</td></tr>
<tr><td>Remaining Gains</td><td>2,166</td><td>20%</td><td>433</td></tr>
<tr><td>(Â£202,166 - Â£200k)</td><td></td><td>(Higher Rate)</td><td></td></tr>
<tr><td><b>Total CGT</b></td><td></td><td></td><td><b>20,433</b></td></tr>
</table></div>
                            </details>
                        </div>
                    `
                }
            }
        ];

        const links = [
            { source: '0', target: 'iht_1' }, { source: 'iht_1', target: 'iht_2' }, { source: 'iht_2', target: 'iht_3' }, { source: 'iht_3', target: 'iht_4' }, { source: 'iht_4', target: 'iht_5' }, { source: 'iht_5', target: 'iht_boss' },
            { source: '0', target: 'cgt_1' }, { source: 'cgt_1', target: 'cgt_2' }, { source: 'cgt_2', target: 'cgt_3' }, { source: 'cgt_3', target: 'cgt_4' }, { source: 'cgt_4', target: 'cgt_boss' }
        ];

        // ================= ECharts é…ç½® =================
        const option = {
            backgroundColor: 'transparent',
            series: [{
                type: 'graph',
                layout: 'force',
                data: data,
                links: links,
                roam: true,
                draggable: true,
                zoom: 0.85,
                label: { show: true, position: 'bottom', color: '#7f8c8d', fontSize: 11, fontWeight: 'bold', formatter: '{b}', distance: 8 },
                itemStyle: { borderColor: '#fff', borderWidth: 2 },
                lineStyle: { color: '#dcdcdc', width: 1.5, curveness: 0.15, opacity: 0.6 },
                force: { repulsion: 450, edgeLength: 100, gravity: 0.06 }
            }]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());

        // ================= äº¤äº’ =================
        const mask = document.getElementById('mask');
        const sheet = document.getElementById('sheet');
        const content = document.getElementById('sheetContent');
        const titleDom = document.getElementById('sheetTitle');

        myChart.on('click', function(params) {
            if (params.data && params.data.info) openSheet(params.data);
        });

        function openSheet(node) {
            const info = node.info;
            const color = node.itemStyle.color;

            titleDom.innerText = node.name.replace('\n', ' ');
            titleDom.style.color = color;

            let html = '';
            if (info.html) html = info.html;

            content.innerHTML = html;
            mask.classList.add('active');
            sheet.classList.add('active');
            
            if (window.MathJax) MathJax.typesetPromise();
        }

        function closeSheet() {
            mask.classList.remove('active');
            sheet.classList.remove('active');
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACCA TX (UK) FA2024 Ultimate Notes</title>
    <script src="https://cdn.staticfile.org/echarts/5.4.3/echarts.min.js"></script>
    <style>
        /* === 1. åŸºç¡€æ ·å¼ === */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background-color: #f4f7f6;
            font-family: -apple-system, "PingFang SC", "Helvetica Neue", sans-serif;
            touch-action: none; /* ç¦ç”¨é»˜è®¤æ‰‹åŠ¿ */
        }
        #main { width: 100vw; height: 100vh; z-index: 1; }

        /* === 2. é¡¶éƒ¨æ  === */
        .header {
            position: fixed; top: 0; left: 0; right: 0; height: 55px;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 10;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none;
        }
        .header h1 { 
            font-size: 16px; color: #2c3e50; font-weight: 800; margin: 0; 
            pointer-events: auto;
        }
        .badge { background: #2c3e50; color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px; }

        /* === 3. åº•éƒ¨è¯¦æƒ…å¼¹çª— (æ”¯æŒé•¿å†…å®¹æ»šåŠ¨) === */
        .mask {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3); z-index: 99; 
            display: none; opacity: 0; transition: opacity 0.2s;
        }
        .mask.active { display: block; opacity: 1; }

        .sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #fff; z-index: 100;
            border-top-left-radius: 24px; border-top-right-radius: 24px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
            transform: translateY(110%); 
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex; flex-direction: column; 
            max-height: 85vh; /* å¢åŠ é«˜åº¦ä»¥å®¹çº³å®Œæ•´ç¬”è®° */
        }
        .sheet.active { transform: translateY(0); }

        /* å¤´éƒ¨ */
        .sheet-head {
            padding: 18px 20px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0; background: #fff; border-radius: 24px 24px 0 0;
        }
        .sheet-title { font-size: 18px; font-weight: 700; color: #2c3e50; margin: 0; }
        .close-btn { 
            font-size: 24px; color: #999; width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            background: #f5f5f5; border-radius: 50%; cursor: pointer;
        }

        /* å†…å®¹åŒº */
        .sheet-body { 
            padding: 20px 24px 50px 24px; 
            overflow-y: auto; -webkit-overflow-scrolling: touch; 
        }

        /* === 4. å†…å®¹æ’ç‰ˆç»„ä»¶ (ç¬”è®°è¿˜åŸ) === */
        .section-title {
            font-size: 14px; font-weight: 800; color: #333; 
            margin: 25px 0 10px 0; padding-left: 10px;
            border-left: 4px solid #ccc; /* JSä¼šä¿®æ”¹é¢œè‰² */
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .section-title:first-child { margin-top: 0; }

        .text-content { font-size: 15px; line-height: 1.7; color: #555; text-align: justify; margin-bottom: 15px; }
        .text-content b { color: #2c3e50; }
        .text-content ul { padding-left: 18px; margin: 5px 0; }
        .text-content li { margin-bottom: 6px; }

        /* è§„åˆ™/ç¨ç‡å¡ç‰‡ */
        .rule-card {
            background: #f8f9fa; border: 1px solid #eee; border-radius: 8px;
            padding: 15px; margin-bottom: 15px;
        }
        
        /* æ¡ˆä¾‹ç›’å­ */
        .case-box {
            background: #fffbf0; border: 1px solid #fcefd0; border-radius: 8px;
            padding: 15px; margin-top: 15px;
        }
        .case-header { font-weight: 700; color: #d35400; font-size: 14px; margin-bottom: 8px; }
        .case-body { font-size: 14px; color: #2d3436; line-height: 1.6; white-space: pre-wrap; }

        /* Proforma ä»£ç å— */
        .proforma {
            background: #2d3436; color: #ecf0f1; padding: 15px; border-radius: 8px;
            font-family: monospace; font-size: 12px; line-height: 1.5; white-space: pre-wrap;
            margin-bottom: 15px; border-left: 4px solid #f1c40f;
        }

        /* è¡¨æ ¼ */
        .tax-table { width: 100%; border-collapse: collapse; font-size: 13px; margin: 10px 0; background:#fff; }
        .tax-table th { background: #eee; padding: 8px; text-align: left; border:1px solid #ddd; }
        .tax-table td { border: 1px solid #ddd; padding: 8px; }

        /* æŠ˜å è§£æ */
        details { margin-top: 10px; }
        summary { color: #3498db; font-weight: 600; cursor: pointer; list-style:none; font-size:13px; }
        .ans { margin-top:10px; padding:10px; background:#fff; border:1px solid #eee; border-radius:6px; font-family:monospace; font-size:13px; }
        
        /* é«˜äº® */
        .hl { color: #c0392b; font-weight: bold; }

    </style>
</head>
<body>

    <div class="header">
        <h1>TX (UK) <span class="badge">FA2024 Note</span></h1>
    </div>

    <div id="main"></div>

    <div class="mask" id="mask" onclick="closeSheet()"></div>
    <div class="sheet" id="sheet">
        <div class="sheet-head">
            <div class="sheet-title" id="sheetTitle">Topic</div>
            <div class="close-btn" onclick="closeSheet()">Ã—</div>
        </div>
        <div class="sheet-body" id="sheetContent"></div>
    </div>

    <script type="text/javascript">
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom, null, {renderer: 'canvas'});

        // ================= é…è‰²å®šä¹‰ (è«å…°è¿ªåŒè‰²) =================
        const c = {
            iht: '#1abc9c',    // è–„è·ç»¿
            iht_sub: '#a8e6cf',
            cgt: '#a29bfe',    // æš®å±±ç´«
            cgt_sub: '#dcd6f7',
            root: '#34495e',
            boss: '#e67e22'
        };

        // ================= å®Œæ•´ç¬”è®°å†…å®¹åº“ (1:1 è¿˜åŸ) =================
        const data = [
            {
                id: 'root', name: 'ACCA TX\n(UK)', category: 'ROOT', symbolSize: 65, itemStyle: { color: c.root },
                info: { title: 'æ ¸å¿ƒå¤ä¹ ä½“ç³»', html: `<div class="text-content">åŒ…å« IHT (é—äº§ç¨) å’Œ CGT (èµ„æœ¬åˆ©å¾—ç¨) ä¸¤å¤§æ¨¡å—çš„å®Œæ•´å¤ä¹ ç¬”è®°ã€‚<br>æ•°æ®åŸºäº FA2024 (25/26 è€ƒå­£)ã€‚</div>` }
            },

            // ======================= IHT æ¨¡å— =======================
            {
                id: 'iht_1', name: '1. Principles\næ ¸å¿ƒæ¦‚å¿µ', category: 'IHT', symbolSize: 50, itemStyle: { color: c.iht },
                info: {
                    title: '1. æ ¸å¿ƒæ¦‚å¿µä¸ç¨ç‡ (Basic Principles)',
                    html: `
                        <div class="section-title" style="border-color:${c.iht}">å¾ç¨åŸºç¡€</div>
                        <div class="text-content">IHT æ˜¯åŸºäº <b>ä»·å€¼è½¬ç§» (Transfer of Value)</b>ï¼Œå³æèµ å¯¼è‡´æèµ è€…è´¢å¯Œå‡å°‘çš„é‡‘é¢ (Diminution in value)ã€‚</div>
                        
                        <div class="section-title" style="border-color:${c.iht}">çº³ç¨äººèº«ä»½</div>
                        <div class="text-content">
                            <ul>
                                <li><b>UK Domiciled (è‹±å›½å±…ç±):</b> å¯¹å…¨çƒèµ„äº§å¾ç¨ã€‚</li>
                                <li><b>Non-UK Domiciled (éè‹±å›½å±…ç±):</b> ä»…å¯¹è‹±å›½èµ„äº§å¾ç¨ã€‚</li>
                            </ul>
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">å…³é”®ç¨ç‡ (2025/26)</div>
                        <div class="rule-card">
                            <div class="text-content">
                                <b>Nil Rate Band (NRB):</b> Â£325,000<br>
                                <b>Residence Nil Rate Band (RNRB):</b> Â£175,000<br>
                                <b>Death Rate:</b> 40%<br>
                                <b>Lifetime Rate:</b> 20% (å—èµ äººä»˜) æˆ– 25% (æèµ äººä»˜)
                            </div>
                        </div>
                    `
                }
            },
            {
                id: 'iht_2', name: '2. Lifetime\nç”Ÿå‰è½¬ç§»', category: 'IHT', symbolSize: 40, itemStyle: { color: c.iht_sub },
                info: {
                    title: '2. ç”Ÿå‰è½¬ç§» (Lifetime Transfers)',
                    html: `
                        <div class="text-content">ç”Ÿå‰çš„ç¤¼ç‰©åˆ†ä¸ºä¸‰ç±»ï¼Œå¤„ç†æ–¹å¼æˆªç„¶ä¸åŒã€‚</div>

                        <div class="section-title" style="border-color:${c.iht}">A. è±å…è½¬ç§» (Exempt Transfers)</div>
                        <div class="text-content">
                            æ— è®ºç”Ÿå‰è¿˜æ˜¯æ­»åï¼Œæ°¸è¿œä¸å¾ç¨ã€‚
                            <ul>
                                <li><b>Spouse/Civil Partner:</b> æ— é™é¢è±å…ã€‚</li>
                                <li><b>Annual Exemption (AE):</b> æ¯å¹´ Â£3,000ã€‚å½“å¹´æ²¡ç”¨å®Œå¯å‘åç»“è½¬ 1 å¹´ (FIFOåŸåˆ™)ã€‚</li>
                                <li><b>Small Gifts:</b> æ¯äººæ¯å¹´ Â£250 (è‹¥è¶…è¿‡åˆ™å…¨é¢ä¸è±å…)ã€‚</li>
                                <li><b>Marriage Exemption:</b> çˆ¶æ¯ Â£5,000ï¼Œç¥–çˆ¶æ¯ Â£2,500ï¼Œå…¶ä»–äºº Â£1,000ã€‚</li>
                                <li><b>Normal expenditure:</b> å¿…é¡»è¯æ˜æ˜¯ä¹ æƒ¯æ€§çš„ä¸”ä¸å½±å“ç”Ÿæ´»æ°´å¹³ã€‚</li>
                            </ul>
                        </div>
                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 1ï¼šç²¾æ‰“ç»†ç®—çš„çˆ·çˆ·</div>
                            <div class="case-body">Grandpa åœ¨ 2024å¹´5æœˆé€ç»™å­™å­ Â£8,000 ç»“å©šç¤¼ç‰©ã€‚ä¸Šä¸€ç¨å¹´æœªåšèµ äºˆã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Transfer Value: Â£8,000
(-) Marriage Exemption: (Â£2,500) (ç¥–çˆ¶æ¯)
(-) AE (Current Year): (Â£3,000)
(-) AE (Brought Forward): (Â£2,500) (ä¸Šå¹´ç»“è½¬)
= Chargeable Value: Â£0 (å®Œå…¨è±å…)</div>
                            </details>
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">B. PET (æ½œåœ¨è±å…è½¬ç§»)</div>
                        <div class="text-content">
                            ä¸ªäººé€ç»™ä¸ªäººçš„ç¤¼ç‰©ã€‚<br>
                            â€¢ ç”Ÿå‰ï¼šä¸äº¤ç¨ã€‚<br>
                            â€¢ åæœï¼šæ´»è¿‡ 7 å¹´å®Œå…¨è±å…ï¼›7 å¹´å†…æ­»äº¡å˜æˆ Chargeableï¼Œéœ€è¡¥äº¤æ­»äº¡ç¨ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">C. CLT (åº”ç¨ç”Ÿå‰è½¬ç§»)</div>
                        <div class="text-content">
                            ä¸ªäººé€ç»™ä¿¡æ‰˜ (Trust) çš„ç¤¼ç‰©ã€‚<br>
                            â€¢ ç”Ÿå‰ï¼šç«‹å³äº¤ç¨ã€‚<br>
                            â€¢ è®¡ç®—ï¼š(Value - Exempt - NRB) x 20% (Trustee) æˆ– 25% (Donor)ã€‚<br>
                            â€¢ <b>7å¹´ç´¯ç§¯åŸåˆ™ï¼š</b>è®¡ç®—å‰©ä½™ NRB æ—¶ï¼Œæ‰£é™¤è¯¥ç¤¼ç‰©<b>ä¹‹å‰ 7 å¹´å†…</b>çš„æ‰€æœ‰ GCTã€‚<br>
                            â€¢ åæœï¼š7 å¹´å†…æ­»äº¡éœ€é‡ç®—æ­»äº¡ç¨ã€‚
                        </div>
                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 2ï¼šå¯Œè±ªçš„ä¿¡æ‰˜ (ç”Ÿå‰ç¨)</div>
                            <div class="case-body">Mr. Rich å‘ä¿¡æ‰˜è½¬å…¥ Â£400,000 (CLT)ã€‚æ­¤å‰7å¹´å†…æ—  CLTï¼Œåªæœ‰ä¸€ä¸ª PETã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Gross Chargeable Transfer: Â£400,000
Less NRB: (Â£325,000) (PETä¸å ç”Ÿå‰NRB)
Taxable Amount: Â£75,000
Lifetime Tax: Â£75,000 Ã— 20% = Â£15,000</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'iht_3', name: '3. Death Tax\næ­»åè¿½æº¯', category: 'IHT', symbolSize: 40, itemStyle: { color: c.iht_sub },
                info: {
                    title: '3. æ­»äº¡æ—¶çš„é¢å¤–ç¨',
                    html: `
                        <div class="text-content">å½“æèµ äººåœ¨é€ç¤¼å 7 å¹´å†…æ­»äº¡ï¼Œä¹‹å‰çš„ PET å’Œ CLT éœ€è¦æ‹‰å›æ¥é‡ç®—ä¸€æ¬¡ç¨ã€‚</div>

                        <div class="section-title" style="border-color:${c.iht}">è®¡ç®—æ­¥éª¤</div>
                        <div class="text-content">
                            1. <b>æŸ¥æ‰¾:</b> æ‰¾å‡ºæ­»å‰ 7 å¹´å†…çš„æ‰€æœ‰ PET å’Œ CLTã€‚<br>
                            2. <b>NRB æ‰£é™¤:</b> ä½¿ç”¨æ­»äº¡æ—¶çš„ NRB (Â£325,000)ï¼Œå‡å»è¯¥ç¤¼ç‰©<b>å†å¾€å‰æ¨ 7 å¹´</b>ç´¯ç§¯çš„ GCTã€‚<br>
                            3. <b>è®¡ç®—ç¨é¢:</b> å‰©ä½™éƒ¨åˆ† Ã— 40%ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">Taper Relief (é€’å‡å‡å…)</div>
                        <div class="text-content">
                            å¦‚æœåœ¨é€ç¤¼åæ´»å¾—å¤Ÿä¹…ï¼Œç¨é¢å¯ä»¥æ‰“æŠ˜ï¼š<br>
                            â€¢ 3-4å¹´: 8æŠ˜ (20% reduction)<br>
                            â€¢ 4-5å¹´: 6æŠ˜ (40% reduction)<br>
                            â€¢ 5-6å¹´: 4æŠ˜ (60% reduction)<br>
                            â€¢ 6-7å¹´: 2æŠ˜ (80% reduction)
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">Credit</div>
                        <div class="text-content">å¯¹äº CLTï¼Œå‡å»ç”Ÿå‰å·²ç»äº¤è¿‡çš„ 20% ç¨ã€‚</div>

                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 3ï¼šä¸å¹¸çš„å¯Œè±ª (æ­»åè¿½æº¯)</div>
                            <div class="case-body">æ¥æ¡ˆä¾‹2ï¼ŒMr. Rich åœ¨é€å‡º Â£100,000 PET çš„ 4.5 å¹´åå»ä¸–ã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Gross Value: Â£100,000
Available NRB: Â£325,000 (è¯¥ PET å‰ 7 å¹´æ— ç¤¼ç‰©)
Tax Payable: Â£0
(æ³¨æ„ï¼šè™½ç„¶æ²¡äº¤ç¨ï¼Œä½†è¿™ Â£100k åƒæ‰äº† NRB é¢åº¦ï¼Œå½±å“åç»­é—äº§ç¨)</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'iht_4', name: '4. Estate\næ­»äº¡é—äº§', category: 'IHT', symbolSize: 40, itemStyle: { color: c.iht_sub },
                info: {
                    title: '4. æ­»äº¡é—äº§ç¨ (Death Estate)',
                    html: `
                        <div class="text-content">å¯¹æ­»è€…å»ä¸–æ—¶æ‹¥æœ‰çš„æ‰€æœ‰èµ„äº§å¾ç¨ã€‚</div>

                        <div class="section-title" style="border-color:${c.iht}">A. é—äº§ä¼°å€¼</div>
                        <div class="text-content">
                            èµ„äº§æŒ‰<b>å¸‚ä»· (Probate Value)</b> è®¡ç®—ã€‚<br>
                            <b>æ‰£é™¤:</b> å€ºåŠ¡ã€æœªä»˜ç¨æ¬¾ã€ä¸§è‘¬è´¹ã€‚<br>
                            <b>è±å…:</b> ç•™ç»™é…å¶ (Spouse) çš„é—äº§å®Œå…¨å…ç¨ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">B. å±…ä½é›¶ç¨ç‡å¸¦ (RNRB)</div>
                        <div class="text-content">
                            <b>é‡‘é¢:</b> Â£175,000ã€‚<br>
                            <b>æ¡ä»¶:</b> é—äº§ä¸­åŒ…å«<b>ä¸»å±…æ‰€</b> ä¸” ç•™ç»™<b>ç›´ç³»åä»£</b> (å­å¥³/å­™å­å¥³)ã€‚<br>
                            <b>é™åˆ¶:</b> å¦‚æœæˆ¿äº§å‡€å€¼ < Â£175kï¼ŒRNRB é™åˆ¶ä¸ºæˆ¿äº§å‡€å€¼ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.iht}">C. NRB çš„è½¬ç§»</div>
                        <div class="text-content">å¦‚æœé…å¶å…ˆå»ä¸–ä¸”æ²¡ç”¨å®Œ NRB æˆ– RNRBï¼Œæœªä½¿ç”¨çš„ç™¾åˆ†æ¯”å¯ä»¥è½¬ç§»ç»™åå»ä¸–çš„é…å¶ã€‚</div>

                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 4ï¼šæœ€åçš„é—äº§</div>
                            <div class="case-body">Mrs. White å»ä¸–ï¼Œç•™ç»™å­™å­ä¸€å¥—æˆ¿ (Â£400k) å’Œå…¶ä»–èµ„äº§ (Â£200k)ã€‚æ— ç”Ÿå‰èµ äºˆã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Chargeable Estate: Â£600,000
Less RNRB: (Â£175,000) (ç¬¦åˆæ¡ä»¶)
Less NRB: (Â£325,000)
Taxable: Â£100,000
Tax: Â£100,000 Ã— 40% = Â£40,000</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'iht_5', name: '5. Proforma\nè®¡ç®—æ¨¡æ¿', category: 'IHT', symbolSize: 40, itemStyle: { color: c.iht_sub },
                info: {
                    title: '5. å¿…èƒŒè®¡ç®—æ¨¡æ¿',
                    html: `
                        <div class="section-title" style="border-color:${c.iht}">Step 1: Lifetime Tax (CLT)</div>
                        <div class="proforma">Transfer Value
(Less: Exemptions - AE, Marriage)
= Chargeable Transfer
(Less: Available NRB - look back 7 years)
= Taxable Amount x 20% (Trustee) or 25% (Donor)</div>

                        <div class="section-title" style="border-color:${c.iht}">Step 2: Death Tax on Gifts</div>
                        <div class="proforma">Gross Chargeable Value (Value at date of gift)
(Less: NRB at death - look back 7 yrs from gift)
= Taxable x 40%
(Less: Taper Relief)
(Less: Lifetime tax paid - only for CLT)</div>

                        <div class="section-title" style="border-color:${c.iht}">Step 3: Death Estate</div>
                        <div class="proforma">Total Assets (Probate Value)
(Less: Debts & Funeral)
(Less: Exempt Legacies to Spouse)
= Chargeable Estate
(Less: RNRB - max Â£175k)
(Less: Remaining NRB - Â£325k minus GCTs in last 7 years)
= Taxable Estate x 40%</div>
                    `
                }
            },
            {
                id: 'iht_boss', name: 'IHT BOSS\nç»¼åˆå¤§é¢˜', category: 'IHT', symbolSize: 50, itemStyle: { color: c.boss },
                info: {
                    title: 'ğŸ‘¹ ç»ˆæ BOSS æˆ˜',
                    html: `
                        <div class="case-box" style="border-color:${c.boss}; background:#fffbf0;">
                            <div class="case-header" style="color:#e67e22">Mr. Bond ç»¼åˆé¢˜</div>
                            <div class="case-body"><b>èƒŒæ™¯ï¼š</b> Mr. Bond (UK Domiciled) äº 2026å¹´3æœˆ20æ—¥ å»ä¸–ã€‚<br>1. 2019å¹´8æœˆ1æ—¥ (CLT): å‘ä¿¡æ‰˜è½¬å…¥ Â£280,000 (Gross)ã€‚<br>2. 2021å¹´10æœˆ1æ—¥ (PET): é€ç»™å¥³å„¿ Â£150,000ã€‚<br>3. æ­»äº¡é—äº§: è‡ªä½æˆ¿å±‹ Â£500,000 (ç»™å„¿å­)ï¼Œè‚¡ç¥¨ Â£300,000ï¼Œå€ºåŠ¡ Â£20,000ï¼Œä¸§è‘¬è´¹ Â£5,000ã€‚</div>
                            
                            <details open>
                                <summary>æŸ¥çœ‹è¯¦ç»†è§£æ</summary>
                                <div class="ans"><b>ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥ç”Ÿå‰èµ äºˆå¯¹ NRB çš„å ç”¨</b>
1. CLT (2019å¹´8æœˆ): ä»·å€¼ Â£280,000ã€‚
   æ­»å‰ 6-7 å¹´ï¼Œå ç”¨ NRBã€‚
   å‰©ä½™ NRB = 325k - 280k = Â£45,000ã€‚

2. PET (2021å¹´10æœˆ): ä»·å€¼ Â£150,000ã€‚
   æ­»å‰ < 7 å¹´ï¼Œå˜æˆ Chargeableã€‚
   PET åƒæ‰äº†å‰©ä¸‹çš„ Â£45,000 å¹¶æº¢å‡ºã€‚
   <b>ç»“è®ºï¼šæ­»äº¡æ—¶ï¼ŒNRB å·²å½’é›¶ (0)ã€‚</b>

<b>ç¬¬äºŒæ­¥ï¼šè®¡ç®—é—äº§ç¨ (Death Estate Tax)</b>
Total Assets: Â£800,000 (Â£500k+Â£300k)
Less: Liabilities: (Â£25,000) (Â£20k+Â£5k)
<b>Net Chargeable Estate: Â£775,000</b>

Less: RNRB: (Â£175,000) (è‡ªä½æˆ¿ç•™ç»™å„¿å­ï¼Œå…¨é¢æ‰£é™¤)
Less: Remaining NRB: (Â£0) (è¢«ç”Ÿå‰ç¤¼ç‰©è€—å°½)

<b>Taxable Estate: Â£600,000</b>
<b>Tax Payable: Â£600,000 Ã— 40% = Â£240,000</b></div>
                            </details>
                        </div>
                    `
                }
            },

            // ======================= CGT æ¨¡å— =======================
            {
                id: 'cgt_1', name: '1. Basic\næ ¸å¿ƒæ¦‚å¿µ', category: 'CGT', symbolSize: 50, itemStyle: { color: c.cgt },
                info: {
                    title: '1. æ ¸å¿ƒæ¦‚å¿µä¸ç¨ç‡ (Basic Principles)',
                    html: `
                        <div class="text-content">å¾ç¨å¯¹è±¡ï¼šä¸ªäººåœ¨çº³ç¨å¹´åº¦å†…å¤„ç½®èµ„äº§äº§ç”Ÿçš„ <b>åˆ©å¾— (Profit)</b>ã€‚<br>è®¡ç®—åŸºç¡€ï¼šåŸºäº Taxable Income ç¡®å®šç¨ç‡ï¼ŒCGT æ˜¯â€œé¡¶â€åœ¨ Income Tax ä¹‹ä¸Šçš„ã€‚</div>

                        <div class="section-title" style="border-color:${c.cgt}">å…³é”®ç¨ç‡ (2025/26)</div>
                        <div class="rule-card">
                            <div class="text-content">
                                <b>å¹´åº¦è±å… (AEA):</b> Â£3,000<br>
                                <b>æ™®é€šèµ„äº§ (Normal):</b> 10% (Basic) / 20% (Higher)<br>
                                <b>ä½å®…æˆ¿äº§ (Residential):</b> 18% (Basic) / <span class="hl-red">24%</span> (Higher)<br>
                                <b>BADR:</b> ä¸€å¾‹ 10%
                            </div>
                        </div>
                    `
                }
            },
            {
                id: 'cgt_2', name: '2. Compute\nè®¡ç®—æ¡†æ¶', category: 'CGT', symbolSize: 40, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '2. åŸºç¡€è®¡ç®—æ¡†æ¶ (General Computation)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">A. è®¡ç®—æ¨¡æ¿</div>
                        <div class="proforma">Gross Proceeds
(Less: Incidental costs)
= Net Proceeds
(Less: Allowable Cost)
(Less: Enhancement Exp)
= Chargeable Gain</div>

                        <div class="section-title" style="border-color:${c.cgt}">B. æ±‡æ€»ä¸çº³ç¨</div>
                        <div class="text-content">
                            1. æ±‡æ€»æ‰€æœ‰ Gainsã€‚<br>
                            2. å‡å» CY Losses (å¿…é¡»å…¨æŠµ)ã€‚<br>
                            3. å‡å» BF Losses (æŠµåˆ° AEA ä¸ºæ­¢)ã€‚<br>
                            4. å‡å» AEA (Â£3,000)ã€‚<br>
                            5. å‰©ä½™ Taxable Gains åˆ†æ®µè®¡ç®—ç¨é¢ã€‚
                        </div>

                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 1ï¼šæ™®é€šèµ„äº§ vs æˆ¿äº§</div>
                            <div class="case-body">Jack (Higher Rate) å–ç”»èµš Â£10kï¼Œå–æˆ¿èµš Â£20kã€‚æ— äºæŸã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">Taxable Gains = (Â£10k + Â£20k) - Â£3,000 = Â£27,000
ç­–ç•¥ï¼šAEA ä¼˜å…ˆæŠµæ‰£é«˜ç¨ç‡ (æˆ¿äº§ 24%)ã€‚

Tax:
ç”» (Â£10,000) x 20% = Â£2,000
æˆ¿äº§ (Â£17,000) x 24% = Â£4,080
Total = Â£6,080</div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'cgt_3', name: '3. Assets\nç‰¹æ®Šèµ„äº§', category: 'CGT', symbolSize: 40, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '3. ç‰¹æ®Šèµ„äº§è§„åˆ™ (Specific Assets)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">A. åŠ¨äº§ (Chattels) - Â£6k è§„åˆ™</div>
                        <div class="text-content">
                            â€¢ <b>Wasting (<50yr):</b> è±å…ã€‚<br>
                            â€¢ <b>Non-wasting (>50yr):</b><br>
                            - ä¹°å– < 6k: è±å…ã€‚<br>
                            - ä¹° < 6k, å– > 6k: <b>Marginal Relief</b>ã€‚Gain é™åˆ¶ä¸º 5/3 x (Proceeds - 6,000)ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.cgt}">B. è‚¡ç¥¨ (Shares)</div>
                        <div class="text-content">åŒ¹é…è§„åˆ™ï¼š1. Same Day -> 2. Next 30 Days -> 3. Share Pool (å‡ä»·)ã€‚</div>
                        
                        <div class="proforma">Share Pool:
| Number | Cost |
| Balance b/f |
| (+) Purchase |
| (-) Disposal (Avg Cost) |</div>
                    `
                }
            },
            {
                id: 'cgt_4', name: '4. Reliefs\næ ¸å¿ƒå‡å…', category: 'CGT', symbolSize: 40, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '4. æ ¸å¿ƒå‡å… (Key Reliefs)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">A. BADR (å•†ä¸šèµ„äº§å¤„ç½®)</div>
                        <div class="text-content">
                            â€¢ <b>æ•ˆæœ:</b> ç¨ç‡é™ä¸º 10%ã€‚<br>
                            â€¢ <b>é™é¢:</b> ç»ˆèº« Â£1 Millionã€‚<br>
                            â€¢ <b>æ¡ä»¶:</b> ç»è¥/æŒè‚¡ > 2å¹´ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.cgt}">B. Rollover Relief (ROR)</div>
                        <div class="text-content">å–æ—§ä¹°æ–°ï¼ŒGain æ¨è¿Ÿã€‚çª—å£ï¼š-1yr ~ +3yrã€‚</div>

                        <div class="section-title" style="border-color:${c.cgt}">C. Gift Relief</div>
                        <div class="text-content">é€å•†ä¸šèµ„äº§ï¼ŒGain è½¬ç§»ç»™å—èµ äººã€‚</div>

                        <div class="section-title" style="border-color:${c.cgt}">D. PPR (ç§å®…)</div>
                        <div class="text-content">è‡ªä½æˆ¿è±å…ã€‚æœ€å 9 ä¸ªæœˆè§†åŒå±…ä½ã€‚</div>
                    `
                }
            },
            {
                id: 'cgt_boss', name: 'CGT BOSS\nç»¼åˆå¤§é¢˜', category: 'CGT', symbolSize: 50, itemStyle: { color: c.boss },
                info: {
                    title: 'ğŸ‘¹ ç»ˆæ BOSS æˆ˜',
                    html: `
                        <div class="case-box" style="border-color:${c.boss}; background:#fffbf0;">
                            <div class="case-header" style="color:#e67e22">Mr. Lucky ç»¼åˆé¢˜</div>
                            <div class="case-body"><b>èƒŒæ™¯ï¼š</b> Mr. Lucky (Higher Rate) 2025/26 æ“ä½œï¼š<br>1. å–èŠ±ç“¶: å– Â£8k, ä¹° Â£4kã€‚<br>2. å–å’–å•¡åº—: èµš Â£200k (BADR)ã€‚<br>3. å–è‚¡ç¥¨: 1000è‚¡ @ Â£5 (2010ä¹°500@Â£1k; 2020ä¹°1000@Â£3k)ã€‚<br>4. BF Loss Â£500ã€‚</div>
                            
                            <details open>
                                <summary>æŸ¥çœ‹è¯¦ç»†è§£æ</summary>
                                <div class="ans"><b>1. èŠ±ç“¶ (Chattel):</b>
Normal Gain = 8k - 4k = 4,000
Marginal = 5/3 Ã— (8,000 - 6,000) = 3,333
Chargeable = <b>Â£3,333</b> (å–å°)

<b>2. å’–å•¡åº— (Business):</b>
Gain Â£200,000. ç¨ç‡ 10% (BADR).

<b>3. è‚¡ç¥¨ (Shares):</b>
Pool: 1500è‚¡, Cost Â£4000. Avg Â£2.67/è‚¡.
Cost = 1000 Ã— 2.67 = 2,667
Gain = 5,000 - 2,667 = <b>Â£2,333</b>

<b>4. æ±‡æ€»è®¡ç®—:</b>
Total Gains = 205,666
(-) Loss Â£500 (-) AEA Â£3,000
Taxable = Â£202,166

Tax:
BADR: 200,000 @ 10% = 20,000
Remaining: 2,166 @ 20% = 433
<b>Total CGT = Â£20,433</b></div>
                            </details>
                        </div>
                    `
                }
            }
        ];

        // è¿çº¿
        const links = [
            { source: 'root', target: 'iht_1' },
            { source: 'iht_1', target: 'iht_2' },
            { source: 'iht_2', target: 'iht_3' },
            { source: 'iht_3', target: 'iht_4' },
            { source: 'iht_4', target: 'iht_5' },
            { source: 'iht_5', target: 'iht_boss' },
            
            { source: 'root', target: 'cgt_1' },
            { source: 'cgt_1', target: 'cgt_2' },
            { source: 'cgt_2', target: 'cgt_3' },
            { source: 'cgt_3', target: 'cgt_4' },
            { source: 'cgt_4', target: 'cgt_boss' }
        ];

        // ================= ECharts é…ç½® =================
        const option = {
            backgroundColor: 'transparent',
            series: [{
                type: 'graph',
                layout: 'force',
                data: data,
                links: links,
                roam: true,
                draggable: true,
                zoom: 0.85,
                label: {
                    show: true, position: 'bottom', color: '#7f8c8d', fontSize: 11, fontWeight: 'bold', formatter: '{b}',
                    distance: 8
                },
                itemStyle: { borderColor: '#fff', borderWidth: 2 },
                lineStyle: { color: '#dcdcdc', width: 1.5, curveness: 0.2 },
                force: { repulsion: 400, edgeLength: 90, gravity: 0.05 }
            }]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());

        // ================= äº¤äº’é€»è¾‘ =================
        const mask = document.getElementById('mask');
        const sheet = document.getElementById('sheet');
        const titleDom = document.getElementById('sheetTitle');
        const contentDom = document.getElementById('sheetContent');

        myChart.on('click', function(params) {
            if (params.data && params.data.info) openSheet(params.data);
        });

        function openSheet(node) {
            const info = node.info;
            const color = node.itemStyle.color;

            titleDom.innerText = node.name.replace('\n', ' ');
            titleDom.style.color = color;

            let html = '';
            if (info.html) {
                html = info.html; // ç›´æ¥ä½¿ç”¨é¢„å®šä¹‰å¥½çš„ HTML å†…å®¹
            }

            contentDom.innerHTML = html;
            mask.classList.add('active');
            sheet.classList.add('active');
        }

        function closeSheet() {
            mask.classList.remove('active');
            sheet.classList.remove('active');
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACCA TX (UK) FA2024 Examiner's Review</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        /* === ç§»åŠ¨ç«¯åº•å±‚ä¼˜åŒ– === */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background-color: #f4f1ea; /* æŠ¤çœ¼ç¾Šçš®çº¸è‰² */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        
        /* å¼ºåˆ¶å®¹å™¨é«˜åº¦ï¼Œé˜²æ­¢ç©ºç™½ */
        #main { width: 100vw; height: 100vh; display: block; }
        
        /* åŠ è½½æç¤º */
        #loading {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #999; font-size: 14px; pointer-events: none; transition: opacity 0.5s;
        }

        /* é¡¶éƒ¨æ  */
        .header {
            position: absolute; top: 0; left: 0; right: 0; z-index: 50;
            padding: 12px 16px; background: rgba(244, 241, 234, 0.95);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { font-size: 16px; color: #2c3e50; margin: 0; font-weight: 800; }
        .badge { background: #e74c3c; color: #fff; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }

        /* åº•éƒ¨å¼¹çª— (Bottom Sheet) */
        .sheet-mask {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4); z-index: 90; display: none;
            backdrop-filter: blur(3px); -webkit-backdrop-filter: blur(3px);
        }
        .sheet-mask.show { display: block; animation: fadeIn 0.2s; }

        .sheet-container {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #fff; z-index: 100;
            border-top-left-radius: 20px; border-top-right-radius: 20px;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.1);
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex; flex-direction: column; max-height: 85vh;
        }
        .sheet-container.show { transform: translateY(0); }

        /* å¼¹çª—å†…å®¹ */
        .sheet-head { 
            padding: 15px 20px; border-bottom: 1px solid #eee; 
            display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;
        }
        .sheet-title { font-size: 18px; font-weight: 800; color: #34495e; margin: 0; }
        .close-icon { font-size: 24px; color: #95a5a6; padding: 5px; cursor: pointer; }

        .sheet-body { 
            padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; 
            background: #fff; 
        }

        /* çŸ¥è¯†ç‚¹æ¨¡å—æ ·å¼ */
        .k-block { margin-bottom: 20px; }
        .k-label { 
            display: inline-block; font-size: 11px; font-weight: 800; color: #fff; 
            padding: 4px 8px; border-radius: 4px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        /* é¢œè‰²å®šä¹‰ */
        .bg-def { background: #95a5a6; }
        .bg-rule { background: #3498db; }
        .bg-exam { background: #e67e22; } /* è€ƒå®˜é‡ç‚¹ */
        .bg-trap { background: #e74c3c; }

        .k-content { font-size: 14px; line-height: 1.6; color: #2c3e50; text-align: justify; }
        
        /* é¢˜ç›®å®¹å™¨ */
        .q-box {
            border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-top: 5px;
            background: #fdfdfd; box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .q-scenario { font-style: italic; color: #555; margin-bottom: 10px; border-left: 3px solid #ccc; padding-left: 10px; }
        
        /* æŠ˜å è§£æ */
        details { margin-top: 10px; border-top: 1px dashed #eee; padding-top: 10px; }
        summary { font-size: 13px; font-weight: 700; color: #2980b9; cursor: pointer; list-style: none; display: flex; justify-content: space-between; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: '+ è§£æ'; }
        details[open] summary::after { content: '- æ”¶èµ·'; }
        
        .answer-area {
            background: #f4faff; padding: 12px; border-radius: 6px; margin-top: 10px;
            font-family: "Menlo", monospace; font-size: 13px; color: #2c3e50; border: 1px solid #d6eaf8;
        }
        .marker-note {
            margin-top: 10px; background: #fff5f5; padding: 10px; border-radius: 6px;
            color: #c0392b; font-size: 12px; font-weight: 600; border: 1px solid #fadbd8;
        }

        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
    </style>
</head>
<body>

    <div id="loading">æ­£åœ¨åŠ è½½å›¾è°±æ•°æ®...</div>

    <div class="header">
        <h1>TX (UK) Master Guide</h1>
        <span class="badge">FA2024</span>
    </div>

    <div id="main"></div>

    <div class="sheet-mask" id="mask" onclick="closeSheet()"></div>
    <div class="sheet-container" id="sheet">
        <div class="sheet-head">
            <h2 class="sheet-title" id="sheetTitle">çŸ¥è¯†ç‚¹</h2>
            <div class="close-icon" onclick="closeSheet()">Ã—</div>
        </div>
        <div class="sheet-body" id="sheetContent">
            </div>
    </div>

    <script type="text/javascript">
        // ç¡®ä¿ DOM åŠ è½½å®Œæ¯•
        window.onload = function() {
            document.getElementById('loading').style.opacity = 0;
            initChart();
        };

        function initChart() {
            var chartDom = document.getElementById('main');
            var myChart = echarts.init(chartDom);

            // ================= è€ƒå®˜çº§å†…å®¹åº“ (FA2024 ä¿®æ­£ç‰ˆ) =================
            
            const data = [
                {
                    id: 'root', name: 'UK TAX\nSystem', category: 0, symbolSize: 80, color: '#34495e',
                    info: {
                        def: 'è‹±å›½ç¨æ³•ä½“ç³»æ ¸å¿ƒ (FA 2024)',
                        rule: 'é€‚ç”¨äº 2025å¹´6æœˆ - 2026å¹´3æœˆ è€ƒå­£ã€‚',
                        exam: '<b>Exam Focus:</b> è€ƒè¯•ä¸­ç¨ç‡è¡¨ä¼šæä¾›ï¼Œä½†ä½ å¿…é¡»ç†Ÿç»ƒè¿ç”¨ï¼Œå°¤å…¶æ˜¯ Income Tax çš„ Proforma å’Œ Corporation Tax çš„ç¨ç‡åˆ†å±‚ã€‚',
                        trap: 'åŠ¡å¿…ä½¿ç”¨ FA2024 æ–°ç¨ç‡ï¼šNIC (8%/6%)ï¼ŒCGT (3k AEA)ï¼ŒVAT (90k)ã€‚æ—§èµ„æ–™å…¨æ‰”æ‰ï¼'
                    }
                },
                // --- IT ---
                {
                    id: '1', name: 'Income Tax\nç»¼åˆè®¡ç®—', category: 1, symbolSize: 65, color: '#e5989b',
                    info: {
                        def: 'ä¸ªäººæ‰€å¾—ç¨ç»¼åˆé¢˜æ˜¯ Section C çš„å¿…è€ƒé¢˜ (15åˆ†)ã€‚',
                        rule: '<b>Order:</b> Non-savings -> Savings -> Dividends.<br><b>PA:</b> Â£12,570 (ANI > Â£100k æ—¶é€’å‡).<br><b>Rates:</b> 20% / 40% / 45%.',
                        exam: '<b>Proforma æŠ€å·§:</b> æ€»æ˜¯å…ˆåˆ—å‡ºä¸‰åˆ— (NS, Sav, Div)ã€‚PA ä¼˜å…ˆæŠµæ‰£ NSã€‚Gift Aid ä¼šæ‰©å±• Basic & Higher Bandsã€‚',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> Alice (23/24)<br>
                                â€¢ Salary: Â£110,000<br>
                                â€¢ Interest: Â£4,000<br>
                                â€¢ Gift Aid Paid (Net): Â£4,000
                            </div>
                            <b>Task:</b> è®¡ç®— Income Tax Liabilityã€‚
                        `,
                        answer: `
                            1. <b>ANI Check (PA):</b><br>
                            Net Income = 110k + 4k = 114,000<br>
                            Gross Gift Aid = 4,000 * 100/80 = 5,000<br>
                            ANI = 114,000 - 5,000 = <b>Â£109,000</b><br>
                            PA Reduction = (109,000 - 100,000)/2 = Â£4,500<br>
                            Available PA = 12,570 - 4,500 = <b>Â£8,070</b><br>
                            <br>
                            2. <b>Band Extension:</b><br>
                            Basic Band = 37,700 + 5,000 = <b>Â£42,700</b><br>
                            <br>
                            3. <b>Tax Calc:</b><br>
                            <b>Non-Savings (110k - 8,070 = 101,930):</b><br>
                            42,700 @ 20% = 8,540<br>
                            59,230 @ 40% = 23,692<br>
                            <b>Savings (4,000):</b><br>
                            PSA (Higher Rate) = Â£500<br>
                            500 @ 0% = 0<br>
                            3,500 @ 40% = 1,400<br>
                            <br>
                            <b>Total Liability = Â£33,632</b>
                        `,
                        trap: 'Markerâ€˜s Note: å¾ˆå¤šè€ƒç”Ÿå¿˜è®°ç®— ANI å¯¼è‡´çš„ PA å‡å°‘ ã€‚è®°ä½å…¬å¼ï¼šANI = Net Income - Gross Gift Aid - Gross Pensionã€‚'
                    }
                },
                {
                    id: '1.1', name: 'Employment\n& NIC', category: 1, symbolSize: 50, color: '#ffb4a2',
                    info: {
                        def: 'P11D ç¦åˆ©ä¸ç¤¾ä¿ã€‚FA2024 NIC è´¹ç‡å¤§å˜ã€‚',
                        rule: '<b>Class 1 (Emp):</b> <span style="color:red;font-weight:bold">8%</span> (Â£12,570-Â£50,270) <br><b>Car:</b> List Price Ã— % (Base 55g=16%) [cite: 21]<br><b>Fuel:</b> Â£27,800 Ã— % [cite: 26]',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> å…¬å¸æä¾›æ±½æ²¹è½¦ (List Â£20k, 100g/km) ç»™å‘˜å·¥ã€‚å…¬å¸æ”¯ä»˜æ‰€æœ‰æ²¹è´¹ï¼Œå‘˜å·¥æœªå¿è¿˜ã€‚<br>
                                <b>Task:</b> è®¡ç®— Taxable Benefitsã€‚
                            </div>
                        `,
                        answer: `
                            1. <b>Car Benefit %:</b><br>
                            (100 - 55) / 5 = 9%<br>
                            Base 16% + 9% = <b>25%</b><br>
                            <br>
                            2. <b>Car Benefit:</b><br>
                            Â£20,000 Ã— 25% = <b>Â£5,000</b><br>
                            <br>
                            3. <b>Fuel Benefit:</b><br>
                            Â£27,800 Ã— 25% = <b>Â£6,950</b>
                        `,
                        trap: 'æ³¨æ„ï¼šClass 1 NIC å·²ç»é™ä¸º 8%ï¼å¦‚æœç”¨æ—§çš„ 12% ç®—ä¼šç›´æ¥æ‰£åˆ†ã€‚å¦å¤–ï¼ŒElectric Car æ˜¯ 2% [cite: 22]ã€‚'
                    }
                },
                
                // --- CT ---
                {
                    id: '2', name: 'Corp Tax\nå…¬å¸ç¨', category: 2, symbolSize: 65, color: '#a0c4ff',
                    info: {
                        def: 'TTP (Taxable Total Profits) ä¸ Augmented Profits (AP)ã€‚',
                        rule: 'Lower Â£50k (19%) - Upper Â£250k (25%) [cite: 48]<br>Marginal Relief = (U - AP) Ã— 3/200 Ã— (TTP/AP) ',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> B Ltd<br>
                                â€¢ Trading Profit: Â£190,000<br>
                                â€¢ Dividends Received (FII): Â£10,000<br>
                                â€¢ æ— å…³è”å…¬å¸ (Associated Companies)
                            </div>
                            <b>Task:</b> è®¡ç®— CT Liabilityã€‚
                        `,
                        answer: `
                            1. <b>TTP:</b> Â£190,000 (è‚¡æ¯ä¸è¿› TTP)<br>
                            <br>
                            2. <b>Augmented Profits (AP):</b><br>
                            190,000 + 10,000 = <b>Â£200,000</b><br>
                            (ç”¨äºç¡®å®šç¨ç‡ï¼šåœ¨ 50k-250k ä¹‹é—´)<br>
                            <br>
                            3. <b>Calculation:</b><br>
                            CT @ 25%: 190,000 Ã— 25% = 47,500<br>
                            Less Marginal Relief:<br>
                            (250,000 - 200,000) Ã— 3/200 Ã— (190k/200k)<br>
                            = 50,000 Ã— 0.015 Ã— 0.95 = (712.5)<br>
                            <br>
                            <b>Tax Payable = Â£46,787.5</b>
                        `,
                        trap: 'å…³é”®é™·é˜±ï¼šDividends Received (FII) ä¸äº¤ç¨ï¼Œä½†å¿…é¡»åŠ å›è®¡ç®— AP ä»¥æŒ¤å‹ä½ çš„ Marginal Relief ç©ºé—´ï¼'
                    }
                },
                {
                    id: '2.1', name: 'Capital\nAllowances', category: 2, symbolSize: 50, color: '#bde0fe',
                    info: {
                        def: 'èµ„æœ¬å‡å… (ç¨åŠ¡æŠ˜æ—§)ã€‚',
                        rule: '<b>Full Expensing:</b> New Main Pool -> 100% FYA <br><b>AIA:</b> Â£1,000,000 <br><b>SRP:</b> 50% FYA + 6% WDA ',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> å…¬å¸è´­ä¹°ï¼š<br>
                                1. å…¨æ–°æœºå™¨ (Main Pool): Â£1.5m<br>
                                2. äºŒæ‰‹æœºå™¨ (Main Pool): Â£200k
                            </div>
                        `,
                        answer: `
                            1. <b>New Machine (Â£1.5m):</b><br>
                            Full Expensing -> 100% Allowable (Â£1.5m)<br>
                            (ä¸å ç”¨ AIA)<br>
                            <br>
                            2. <b>Second-hand (Â£200k):</b><br>
                            ä¸é€‚ç”¨ Full Expensingã€‚<br>
                            ä½¿ç”¨ AIA -> 100% Allowable (Â£200k)<br>
                            <br>
                            <b>Total Allowances = Â£1,700,000</b>
                        `,
                        trap: 'Full Expensing åªé€‚ç”¨äº**å…¨æ–°**çš„ä¸»æ± èµ„äº§ã€‚äºŒæ‰‹èµ„äº§å¿…é¡»èµ° AIA æˆ– WDAã€‚'
                    }
                },

                // --- CGT ---
                {
                    id: '3', name: 'CGT\nèµ„æœ¬åˆ©å¾—', category: 3, symbolSize: 65, color: '#caffbf',
                    info: {
                        def: 'ä¸ªäººèµ„äº§å¤„ç½®æ”¶ç›Šç¨ã€‚',
                        rule: '<b>AEA:</b> Â£3,000 <br><b>Resi Rate:</b> 18% / <span style="color:red;font-weight:bold">24%</span> (FA24é™ç¨) <br><b>Other:</b> 10% / 20% ',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> é«˜ç¨ç‡çº³ç¨äººå‡ºå”®ï¼š<br>
                                1. ä½å®… (Residential Gain): Â£10,000<br>
                                2. è‚¡ç¥¨ (Other Gain): Â£5,000
                            </div>
                            <b>Task:</b> ä¼˜åŒ–è®¡ç®— CGTã€‚
                        `,
                        answer: `
                            <b>Principle:</b> AEA ä¼˜å…ˆæŠµæ‰£é«˜ç¨ç‡èµ„äº§ã€‚<br>
                            <br>
                            1. <b>Residential (Â£10k):</b><br>
                            æŠµæ‰£ AEA (Â£3,000)<br>
                            Taxable: Â£7,000 @ <b>24%</b> = Â£1,680<br>
                            (æ³¨ï¼šFA24 ä½å®…é«˜ç¨ç‡æ˜¯ 24% ä¸æ˜¯ 28%)<br>
                            <br>
                            2. <b>Shares (Â£5k):</b><br>
                            Taxable: Â£5,000 @ 20% = Â£1,000<br>
                            <br>
                            <b>Total CGT = Â£2,680</b>
                        `,
                        trap: 'è€ƒç”Ÿå¸¸çŠ¯é”™è¯¯ï¼š1. ä½¿ç”¨æ—§çš„ AEA (Â£6k)ã€‚2. ä½¿ç”¨æ—§çš„ä½å®…ç¨ç‡ (28%)ã€‚FA24 ä¸­è¿™ä¸¤ä¸ªéƒ½å˜äº†ï¼'
                    }
                },
                {
                    id: '3.1', name: 'BADR\nå•†ä¸šèµ„äº§', category: 3, symbolSize: 50, color: '#fdffb6',
                    info: {
                        def: 'Business Asset Disposal Relief (10% ç¨ç‡)ã€‚',
                        rule: '<b>Rate:</b> 10% [cite: 78]<br><b>Lifetime Limit:</b> Â£1 million [cite: 78]',
                        exam: 'å¿…é¡»æŒæœ‰ 2 å¹´ä»¥ä¸Šã€‚å¦‚æœæ˜¯è‚¡ä»½ï¼Œéœ€æ»¡è¶³ 5% æŒè‚¡ + å‘˜å·¥èº«ä»½ã€‚',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> å‡ºå”®ä¸ªäººå…¬å¸è·åˆ© Â£1.2mã€‚ç¬¦åˆ BADR æ¡ä»¶ã€‚æ— å…¶ä»–æ”¶ç›Šã€‚
                            </div>
                        `,
                        answer: `
                            <b>1. BADR Portion (Max Â£1m):</b><br>
                            Â£1,000,000 @ 10% = Â£100,000<br>
                            <br>
                            <b>2. Remaining (Â£200k):</b><br>
                            (200,000 - 3,000 AEA) = 197,000<br>
                            æŒ‰æ™®é€šç¨ç‡ (å‡è®¾é«˜ç¨ç‡):<br>
                            197,000 @ 20% = Â£39,400<br>
                            <br>
                            <b>Total = Â£139,400</b>
                        `,
                        trap: 'BADR çš„ Â£1m æ˜¯ç»ˆèº«é™é¢ã€‚é¢˜ç›®å¦‚æœè¯´â€œä¹‹å‰å·²ç»ç”¨äº† Â£400kâ€ï¼Œé‚£è¿™æ¬¡å°±åªå‰© Â£600k é¢åº¦äº†ã€‚'
                    }
                },

                // --- IHT ---
                {
                    id: '4', name: 'IHT\né—äº§ç¨', category: 4, symbolSize: 65, color: '#bdb2ff',
                    info: {
                        def: '7å¹´åŸåˆ™ä¸æ­»äº¡ç¨è®¡ç®—ã€‚',
                        rule: '<b>NRB:</b> Â£325,000 [cite: 63]<br><b>RNRB:</b> Â£175,000 [cite: 63]<br><b>Death Rate:</b> 40% [cite: 63]',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> 2024å¹´å»ä¸–ã€‚Estate Â£600k (å«è‡ªä½æˆ¿ Â£300k)ã€‚<br>
                                æˆ¿å­ç•™ç»™å„¿å­ã€‚ç”Ÿå‰æ— èµ ä¸ã€‚
                            </div>
                            <b>Task:</b> è®¡ç®— IHTã€‚
                        `,
                        answer: `
                            1. <b>Exemptions:</b><br>
                            NRB = Â£325,000<br>
                            RNRB = Â£175,000 (é€‚ç”¨ï¼Œç•™ç»™ç›´ç³»)<br>
                            Total Exempt = Â£500,000<br>
                            <br>
                            2. <b>Taxable:</b><br>
                            600,000 - 500,000 = Â£100,000<br>
                            <br>
                            3. <b>Tax:</b><br>
                            100,000 @ 40% = <b>Â£40,000</b>
                        `,
                        trap: 'RNRB åªæœ‰åœ¨æˆ¿å­ç•™ç»™ Direct Descendant (å­å¥³/å­™å­å¥³) æ—¶æ‰é€‚ç”¨ã€‚ç•™ç»™å…„å¼Ÿå§å¦¹æˆ–ä¾„å­æ˜¯ä¸è¡Œçš„ï¼'
                    }
                },

                // --- VAT ---
                {
                    id: '5', name: 'VAT\nå¢å€¼ç¨', category: 5, symbolSize: 60, color: '#ffc6ff',
                    info: {
                        def: 'æ³¨å†Œä¸é”€é¡¹ç¨è®¡ç®—ã€‚',
                        rule: '<b>Registration:</b> >Â£90,000 (Historical/Future) <br><b>Deregistration:</b> <Â£88,000 ',
                        question: `
                            <div class="q-scenario">
                                <b>Scenario:</b> å”®ä»· Â£100 (Net)ã€‚æä¾› 5% PPDã€‚å®¢æˆ·å®é™…ä»˜æ¬¾ Â£95ã€‚
                            </div>
                            <b>Task:</b> è®¡ç®— Output VATã€‚
                        `,
                        answer: `
                            <b>Rule:</b> åŸºäºå®é™…ä»˜æ¬¾é¢ (Actual Consideration)ã€‚<br>
                            <br>
                            VAT = Â£95 Ã— 20% = <b>Â£19</b><br>
                            <br>
                            (å¦‚æœå®¢æˆ·æ²¡æ‹¿æŠ˜æ‰£ä»˜äº† Â£100ï¼ŒVAT å°±æ˜¯ Â£20)
                        `,
                        trap: 'æ³¨å†Œé—¨æ§› FA24 æ¶¨åˆ°äº† Â£90,000ï¼åˆ«ç”¨æ—§çš„ 85kã€‚å¦å¤– PPD è®¡ç®—è§„åˆ™ä¹Ÿæ˜¯è¿‘å¹´æ”¹çš„ï¼Œä¸€å®šè¦æŒ‰å®é™…æ”¶åˆ°çš„é’±ç®—ç¨ã€‚'
                    }
                }
            ];

            // è¿çº¿
            const links = [
                { source: 'root', target: '1' }, { source: '1', target: '1.1' },
                { source: 'root', target: '2' }, { source: '2', target: '2.1' }, { source: '2', target: '2.2' },
                { source: 'root', target: '3' }, { source: '3', target: '3.1' },
                { source: 'root', target: '4' },
                { source: 'root', target: '5' }
            ];

            // é…ç½®
            const option = {
                backgroundColor: '#f4f1ea',
                series: [{
                    type: 'graph',
                    layout: 'force',
                    data: data,
                    links: links,
                    roam: true,
                    label: { show: true, position: 'bottom', color: '#555', fontSize: 11, fontWeight: 'bold' },
                    itemStyle: { borderColor: '#fff', borderWidth: 2, shadowBlur: 5, shadowColor: 'rgba(0,0,0,0.2)' },
                    lineStyle: { color: '#bbb', curveness: 0.1, width: 1.5 },
                    force: { repulsion: 350, edgeLength: 90, gravity: 0.08 }
                }]
            };

            myChart.setOption(option);
            
            // ç‚¹å‡»äº¤äº’
            myChart.on('click', function(params) {
                if (params.data.info) showSheet(params.data);
            });
        }

        // å¼¹çª—é€»è¾‘
        const mask = document.getElementById('mask');
        const sheet = document.getElementById('sheet');
        const title = document.getElementById('sheetTitle');
        const content = document.getElementById('sheetContent');

        function showSheet(node) {
            const info = node.info;
            title.innerText = node.name.replace('\n', ' ');
            
            let html = `
                <div class="k-block">
                    <span class="k-label bg-def">Concept</span>
                    <div class="k-content">${info.def}</div>
                </div>
                <div class="k-block">
                    <span class="k-label bg-rule">Rules (FA24)</span>
                    <div class="k-content">${info.rule}</div>
                </div>
            `;

            if (info.question) {
                html += `
                    <div class="k-block">
                        <span class="k-label bg-exam">Comprehensive Question</span>
                        <div class="q-box">
                            ${info.question}
                            <details>
                                <summary></summary>
                                <div class="answer-area">${info.answer}</div>
                                <div class="marker-note">ğŸ“Œ ${info.trap}</div>
                            </details>
                        </div>
                    </div>
                `;
            } else if (info.trap) {
                 html += `<div class="marker-note">ğŸ“Œ ${info.trap}</div>`;
            }

            content.innerHTML = html;
            mask.classList.add('show');
            sheet.classList.add('show');
        }

        function closeSheet() {
            mask.classList.remove('show');
            sheet.classList.remove('show');
        }
    </script>
</body>
</html>

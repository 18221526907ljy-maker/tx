<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACCA TX (UK) FA2024 å¤ä¹ æ‰‹è´¦</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* === æŸ”å’Œé£æ ¼ CSS è®¾è®¡ === */
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background-color: #f9f7f2; /* æš–è°ƒå¥¶æ²¹ç™½èƒŒæ™¯ */
            font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; 
        }
        #main { width: 100vw; height: 100vh; }
        
        /* é¡¶éƒ¨æ ‡é¢˜æ  - ç£¨ç ‚ç»ç’ƒæ•ˆæœ */
        .header {
            position: absolute; top: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.7); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 15px 20px; z-index: 100; 
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 15px rgba(0,0,0,0.03);
        }
        .header h1 { color: #5d5c61; margin: 0; font-size: 18px; font-weight: 600; letter-spacing: 1px; }
        .header .tag { 
            background: #ff9a9e; background: linear-gradient(to right, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            color: #fff; padding: 3px 10px; border-radius: 12px; font-size: 11px; margin-left: 10px; font-weight: bold;
        }
        
        /* åº•éƒ¨è¯¦æƒ…å¡ç‰‡ - åœ†æ¶¦å¯çˆ± */
        .detail-panel {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: #ffffff; 
            border-top-left-radius: 25px; border-top-right-radius: 25px;
            box-shadow: 0 -5px 40px rgba(0,0,0,0.08);
            padding: 25px 20px; z-index: 100;
            transform: translateY(110%); 
            transition: transform 0.4s cubic-bezier(0.2, 0.9, 0.3, 1.1); /* æ›´æœ‰å¼¹æ€§çš„åŠ¨ç”» */
            max-height: 65vh; overflow-y: auto;
        }
        .detail-panel.active { transform: translateY(0); }
        
        /* å¡ç‰‡å†…å®¹ */
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
        .panel-title { color: #4a4a4a; font-size: 22px; font-weight: bold; margin: 0; }
        .panel-close { 
            color: #999; background: #f0f0f0; width: 30px; height: 30px; border-radius: 50%; 
            text-align: center; line-height: 28px; font-size: 20px; cursor: pointer; 
        }
        
        .section { margin-bottom: 18px; }
        .section-label { 
            display: inline-block; color: #fff; font-size: 11px; padding: 4px 10px; 
            border-radius: 12px; margin-bottom: 8px; font-weight: bold; 
        }
        .section-content { color: #666; font-size: 15px; line-height: 1.7; margin-left: 4px;}
        
        /* ç‰¹æ®Šæ–‡æœ¬æ¡†æ ·å¼ - æŸ”å’Œè‰²è°ƒ */
        .highlight { color: #e88888; font-weight: bold; background: #fff0f0; padding: 0 4px; border-radius: 4px;}
        
        /* å…¬å¼æ¡†ï¼šæµ…è“ */
        .formula-box { 
            background: #f0f8ff; border-left: 4px solid #a2d2ff; 
            padding: 10px; margin: 5px 0; border-radius: 0 8px 8px 0;
            font-family: 'Courier New', monospace; color: #555; font-size: 14px; 
        }
        /* æ¡ˆä¾‹æ¡†ï¼šæµ…ç»¿ */
        .case-box { 
            background: #f1f8e9; border-left: 4px solid #c5e1a5; 
            padding: 10px; margin: 5px 0; border-radius: 0 8px 8px 0;
            color: #556b2f; font-size: 14px; 
        }
        /* é¿å‘æ¡†ï¼šæµ…ç²‰ */
        .warning-box { 
            background: #fff5f5; border-left: 4px solid #ffcdd2; 
            padding: 10px; margin: 5px 0; border-radius: 0 8px 8px 0;
            color: #d65a5a; font-size: 14px; 
        }

        /* æ ‡ç­¾é¢œè‰²ç±» */
        .bg-blue { background: #a2d2ff; }
        .bg-green { background: #a8e6cf; color: #333; }
        .bg-red { background: #ffaaa5; }
        .bg-purple { background: #dcd6f7; color: #555; }

        /* å¼•å¯¼æç¤º */
        .tutorial-tip {
            position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%);
            color: #b0b0b0; font-size: 14px; pointer-events: none;
            animation: fadeOut 4s forwards; animation-delay: 2s; letter-spacing: 1px;
        }
        @keyframes fadeOut { to { opacity: 0; } }
    </style>
</head>
<body>

    <div class="header">
        <div>ğŸŒ¸ TX (UK) <span class="tag">FA2024</span></div>
        <div style="font-size:12px; color:#999;">Exam 25/26</div>
    </div>

    <div id="main"></div>
    <div class="tutorial-tip">è½»è§¦èŠ‚ç‚¹ âœ¨ å”¤é†’çŸ¥è¯†ç‚¹</div>

    <div class="detail-panel" id="detailPanel">
        <div class="panel-header">
            <h2 class="panel-title" id="nodeTitle">èŠ‚ç‚¹åç§°</h2>
            <div class="panel-close" onclick="closePanel()">Ã—</div>
        </div>
        <div id="nodeContent">
            </div>
    </div>

    <script type="text/javascript">
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;

        // ================= è«å…°è¿ªé…è‰²æ–¹æ¡ˆ =================
        // æ ¸å¿ƒé€»è¾‘ï¼šä½é¥±å’Œåº¦ï¼Œé«˜æ˜åº¦ï¼Œçœ‹èµ·æ¥å¾ˆèˆ’æœ
        const colors = {
            root: '#ffcfdf',      // æµ…ç²‰ä¸»èŠ‚ç‚¹
            it: '#ffaaa5',        // å¹²ç‡¥ç«ç‘° (IT)
            ct: '#a2d2ff',        // é›¾éœ¾è“ (CT)
            cgt: '#dcd6f7',       // é¦™èŠ‹ç´« (CGT)
            iht: '#a8e6cf',       // è–„è·ç»¿ (IHT)
            vat: '#fdffb6'        // å¥¶æ²¹é»„ (VAT)
        };

        const categories = [
            { name: 'System', itemStyle: { color: colors.root, borderColor: '#fff', borderWidth: 2 } },
            { name: 'Income Tax', itemStyle: { color: colors.it } }, 
            { name: 'Corporation Tax', itemStyle: { color: colors.ct } }, 
            { name: 'CGT', itemStyle: { color: colors.cgt } }, 
            { name: 'IHT', itemStyle: { color: colors.iht } }, 
            { name: 'VAT', itemStyle: { color: colors.vat } }  
        ];

        // èŠ‚ç‚¹æ•°æ®ï¼šä¿æŒèµ„æ·±å†…å®¹ï¼Œä¼˜åŒ–åˆ†ç±»ç´¢å¼•
        const nodes = [
            { 
                id: '0', name: 'UK Tax System', symbolSize: 85, category: 0, 
                info: { 
                    def: 'è‹±å›½ç¨æ³•æ ¸å¿ƒä½“ç³» (FA 2024)',
                    rule: 'é€‚ç”¨äº 2025å¹´6æœˆ - 2026å¹´3æœˆ è€ƒå­£',
                    case: 'æ‰€æœ‰è®¡ç®—å¿…é¡»éµå¾ª FA2024 ç¨ç‡ã€‚æœ¬å›¾è°±å·²æ ¹æ®æœ€æ–°è€ƒçº²æ›´æ–°æ•°æ®ã€‚',
                    tip: 'Tips: è€ƒè¯•æ—¶ç¨ç‡è¡¨ä¼šåœ¨è¯•å·ä¸­æä¾›ï¼Œä½†æ ¸å¿ƒé—¨æ§›å¿…é¡»èƒŒä¸‹æ¥ã€‚'
                }
            },

            // --- Income Tax (ç²‰è‰²ç³») ---
            { 
                id: '1', name: 'Income Tax\nä¸ªç¨', symbolSize: 65, category: 1,
                info: { def: 'ä¸ªäººæ‰€å¾—ç¨æ±‡æ€»', rule: 'NS/Sav/Div ä¸‰ç±»æ”¶å…¥é¡ºåºå¾ç¨' } 
            },
            { 
                id: '1.1', name: 'Rates & PA\nç¨ç‡ä¸å…ç¨é¢', symbolSize: 50, category: 1,
                info: {
                    def: 'ä¸ªäººå…ç¨é¢ (PA) ä¸ ANI é™åˆ¶',
                    rule: 'PA: Â£12,570<br>Basic: Â£37,700<br>Higher: Â£125,140<br><span class="formula">ANI > Â£100k: æ¯Â£2 æ”¶å…¥å‡å°‘ Â£1 PA</span>',
                    case: 'Case: ANI Â£110,000ã€‚<br>PA å‡å°‘ = (110,000-100,000)/2 = Â£5,000ã€‚<br>å‰©ä½™ PA = 12,570 - 5,000 = Â£7,570ã€‚',
                    tip: 'å¦‚æœ ANI > Â£125,140ï¼ŒPA ç›´æ¥å½’é›¶ã€‚'
                }
            },
            { 
                id: '1.2', name: 'NIC\nå›½æ°‘ä¿é™©', symbolSize: 50, category: 1,
                info: {
                    def: 'FA2024 æ ¸å¿ƒè€ƒç‚¹ï¼šè´¹ç‡å¤§å¹…ä¸‹é™',
                    rule: '<b>Class 1 (å‘˜å·¥):</b> Â£12,571-Â£50,270 ç¨ç‡é™ä¸º <span class="highlight">8%</span><br><b>Class 4 (è‡ªé›‡):</b> ç¨ç‡é™ä¸º <span class="highlight">6%</span>',
                    case: 'Case: è‡ªé›‡åˆ©æ¶¦ Â£40,000ã€‚<br>Class 2: åºŸé™¤(ç‰¹æ®Šæƒ…å†µé™¤å¤–)ã€‚<br>Class 4: (Â£40,000 - Â£12,570) Ã— 6% = Â£1,645.80ã€‚',
                    tip: 'åƒä¸‡åˆ«ç”¨æ—§ç¨ç‡(12%/9%)ï¼è¿™æ˜¯ä»Šå¹´æœ€å¤§çš„é™·é˜±ã€‚'
                }
            },
            { 
                id: '1.3', name: 'Employment\né›‡ä½£ç¦åˆ©', symbolSize: 45, category: 1,
                info: {
                    def: 'å®ç‰©ç¦åˆ©å¾ç¨ (Benefits in Kind)',
                    rule: '<b>æ±½æ²¹è½¦:</b> List Price Ã— CO2% (55gèµ·, 16%èµ·, æ¯5g+1%, Max 37%)<br><b>ç‡ƒæ²¹:</b> Â£27,800 Ã— CO2%',
                    case: 'Case: æ±½æ²¹è½¦æ’æ”¾100gã€‚<br>ç‡ = 16% + (100-55)/5 = 25%ã€‚<br>Benefit = List Price Ã— 25%ã€‚',
                    tip: 'ç”µåŠ¨è½¦ (0g/km) çš„æ¯”ä¾‹æ˜¯ 2%ã€‚'
                }
            },

            // --- Corporation Tax (è“è‰²ç³») ---
            { 
                id: '2', name: 'Corp Tax\nå…¬å¸ç¨', symbolSize: 65, category: 2,
                info: { def: 'å…¬å¸åº”ç¨æ€»åˆ©æ¶¦ (TTP) è®¡ç®—', rule: 'ä¼šè®¡æœŸ vs è´¢åŠ¡å¹´ (FY)' } 
            },
            { 
                id: '2.1', name: 'Tax Liability\nç¨æ¬¾è®¡ç®—', symbolSize: 50, category: 2,
                info: {
                    def: 'åŒé‡ç¨ç‡ä¸è¾¹é™…å‡å…',
                    rule: '<b>Lower Limit:</b> Â£50,000 (19%)<br><b>Upper Limit:</b> Â£250,000 (25%)<br><span class="formula">Marginal Relief = (U - A) Ã— 3/200</span>',
                    case: 'Case: TTP=Â£150k (æ— å…³è”)ã€‚<br>CT = 150kÃ—25% - (250k-150k)Ã—3/200 = Â£36,000ã€‚',
                    tip: 'Augmented Profits (TTP+FGL) ç”¨æ¥ç¡®å®šç¨ç‡ï¼Œä¸æ˜¯ç”¨æ¥ä¹˜ç¨ç‡çš„ï¼'
                }
            },
            { 
                id: '2.2', name: 'Cap Allowances\nèµ„æœ¬å‡å…', symbolSize: 50, category: 2,
                info: {
                    def: 'ä¼ä¸šå›ºå®šèµ„äº§æŠµç¨',
                    rule: '<b>Full Expensing:</b> å…¨æ–°ä¸»æ± èµ„äº§ 100% FYA<br><b>AIA:</b> Â£1,000,000 (äºŒæ‰‹/SRP)<br><b>SRP:</b> 50% FYA (å…¨æ–°) + 6% WDA',
                    case: 'Case: å…¬å¸ä¹°å…¨æ–°æœºå™¨ Â£2mã€‚<br>ç›´æ¥ Full Expensing æŠµæ‰£ Â£2mã€‚<br>TTP ç›´æ¥å‡å°‘ Â£2mã€‚',
                    tip: 'è½¦ä¸äº«å— AIA æˆ– Full Expensingã€‚'
                }
            },

            // --- CGT (ç´«è‰²ç³») ---
            { 
                id: '3', name: 'CGT\nèµ„æœ¬åˆ©å¾—', symbolSize: 65, category: 3,
                info: { def: 'ä¸ªäººä¸å…¬å¸çš„èµ„äº§å¤„ç½®', rule: 'Proceeds - Cost' } 
            },
            { 
                id: '3.1', name: 'Individual\nä¸ªäººCGT', symbolSize: 50, category: 3,
                info: {
                    def: 'ä¸ªäººèµ„äº§å¤„ç½®ç¨ç‡ (FA24é‡è¦å˜åŒ–)',
                    rule: '<b>AEA (å…ç¨é¢):</b> é™è‡³ <span class="highlight">Â£3,000</span><br><b>ä½å®…ç¨ç‡:</b> 18% / <span class="highlight">24%</span> (åŸ28%)<br><b>æ™®é€š:</b> 10% / 20%',
                    case: 'Case: é«˜ç¨ç‡è€…å–æŠ•èµ„æˆ¿èµš Â£13kã€‚<br>åº”ç¨ = 13k - 3k = Â£10kã€‚<br>ç¨ = Â£10k Ã— 24% = Â£2,400ã€‚',
                    tip: 'ä½å®…é«˜ç¨ç‡é™åˆ°äº† 24%ï¼Œåˆ«ç”¨æ—§æ•°å­— 28%ï¼'
                }
            },
            { 
                id: '3.2', name: 'BADR\nå•†ä¸šèµ„äº§ä¼˜æƒ ', symbolSize: 45, category: 3,
                info: {
                    def: 'ä¼ä¸šå®¶å¤„ç½®ä¸šåŠ¡ä¼˜æƒ ',
                    rule: 'ç¨ç‡: 10%<br>ç»ˆèº«é™é¢: Â£1,000,000',
                    case: 'Case: å–å…¬å¸èµšäº† Â£800kã€‚<br>CGT = Â£800k Ã— 10% = Â£80kã€‚<br>(çœäº†80k)',
                    tip: 'å¿…é¡»æŒæœ‰å¹¶ç»è¥è‡³å°‘2å¹´ã€‚'
                }
            },

            // --- IHT (ç»¿è‰²ç³») ---
            { 
                id: '4', name: 'IHT\né—äº§ç¨', symbolSize: 65, category: 4,
                info: { def: 'æ­»äº¡ç¨ä¸ç”Ÿå‰èµ ä¸', rule: '7å¹´ç´¯ç§¯åŸåˆ™' } 
            },
            { 
                id: '4.1', name: 'Death Tax\næ­»äº¡ç¨', symbolSize: 50, category: 4,
                info: {
                    def: 'æ­»äº¡æ—¶é—äº§è®¡ç¨',
                    rule: '<b>NRB:</b> Â£325,000<br><b>RNRB:</b> Â£175,000 (ç›´ç³»åä»£ç»§æ‰¿ä¸»å±…æ‰€)<br>ç¨ç‡: 40%',
                    case: 'Case: ç•™ç»™å„¿å­çš„æˆ¿å­ä»·å€¼Â£500kã€‚<br>å…ç¨é¢ = 325k+175k = 500kã€‚<br>åº”ç¨ä¸º0ã€‚',
                    tip: 'RNRB åœ¨é—äº§æ€»å€¼è¶…è¿‡ Â£2m æ—¶ä¼šé€’å‡ã€‚'
                }
            },

            // --- VAT (é»„è‰²ç³») ---
            { 
                id: '5', name: 'VAT\nå¢å€¼ç¨', symbolSize: 65, category: 5,
                info: { def: 'æ³¨å†Œä¸ç‰¹æ®Šæœºåˆ¶', rule: 'Output VAT - Input VAT' } 
            },
            { 
                id: '5.1', name: 'Limits\næ³¨å†Œé—¨æ§›', symbolSize: 50, category: 5,
                info: {
                    def: 'å¼ºåˆ¶æ³¨å†Œä¸æ³¨é”€ (FA24ä¸Šè°ƒ)',
                    rule: '<b>æ³¨å†Œ:</b> è¿‡å»12ä¸ªæœˆ > <span class="highlight">Â£90,000</span><br><b>æ³¨é”€:</b> æœªæ¥12ä¸ªæœˆ < <span class="highlight">Â£88,000</span>',
                    case: 'Case: 10æœˆ31æ—¥å‘ç°è¿‡å»12ä¸ªæœˆé”€å”® Â£91,000ã€‚<br>éœ€åœ¨11æœˆ30æ—¥å‰é€šçŸ¥ã€‚',
                    tip: 'é—¨æ§›ä»85kæ¶¨åˆ°äº†90kã€‚'
                }
            }
        ];

        const links = [
            { source: '0', target: '1' }, { source: '0', target: '2' }, { source: '0', target: '3' }, { source: '0', target: '4' }, { source: '0', target: '5' },
            { source: '1', target: '1.1' }, { source: '1', target: '1.2' }, { source: '1', target: '1.3' },
            { source: '2', target: '2.1' }, { source: '2', target: '2.2' },
            { source: '3', target: '3.1' }, { source: '3', target: '3.2' },
            { source: '4', target: '4.1' },
            { source: '5', target: '5.1' }
        ];

        option = {
            backgroundColor: '#f9f7f2', // å¥¶æ²¹åº•è‰²
            series: [
                {
                    type: 'graph',
                    layout: 'force',
                    data: nodes,
                    links: links,
                    categories: categories,
                    roam: true,
                    draggable: true,
                    zoom: 0.75,
                    label: {
                        show: true,
                        position: 'bottom',
                        formatter: '{b}',
                        color: '#666', // å­—ä½“é¢œè‰²å˜æ·±
                        fontSize: 12,
                        fontWeight: 500,
                        fontFamily: 'sans-serif'
                    },
                    itemStyle: {
                        borderColor: '#fff',
                        borderWidth: 3,
                        shadowBlur: 15,
                        shadowColor: 'rgba(0,0,0,0.1)' // æŸ”å’Œé˜´å½±
                    },
                    lineStyle: {
                        color: '#d3d3d3', // æµ…ç°è¿çº¿
                        curveness: 0.15,
                        width: 2,
                        opacity: 0.8
                    },
                    force: {
                        repulsion: 450,
                        edgeLength: [80, 140],
                        gravity: 0.04
                    }
                }
            ]
        };

        myChart.setOption(option);
        window.addEventListener('resize', function() { myChart.resize(); });

        // ================= äº¤äº’é€»è¾‘ =================
        
        const panel = document.getElementById('detailPanel');
        const titleDom = document.getElementById('nodeTitle');
        const contentDom = document.getElementById('nodeContent');

        // ç‚¹å‡»èŠ‚ç‚¹äº‹ä»¶
        myChart.on('click', function (params) {
            if (params.dataType === 'node' && params.data.info) {
                showPanel(params.data);
            }
        });

        // ç‚¹å‡»ç©ºç™½å¤„å…³é—­
        myChart.getZr().on('click', function (event) {
            if (!event.target) {
                closePanel();
            }
        });

        function showPanel(node) {
            const info = node.info;
            
            // è®¾ç½®æ ‡é¢˜é¢œè‰²ä¸èŠ‚ç‚¹ä¸€è‡´
            const categoryColor = categories[node.category].itemStyle.color;
            titleDom.innerText = node.name.replace('\n', ' ');
            titleDom.style.color = categoryColor;
            // åŠ æ·±ä¸€ç‚¹æ ‡é¢˜é¢œè‰²ä»¥é˜²å¤ªæµ…çœ‹ä¸æ¸…
            if(node.category === 0) titleDom.style.color = '#e0a0a0'; 

            let html = '';
            
            // æ ‡ç­¾é¢œè‰²é€»è¾‘
            let labelClass = 'bg-blue';
            if(node.category === 4) labelClass = 'bg-green'; // IHT
            if(node.category === 1) labelClass = 'bg-red';   // IT
            if(node.category === 3) labelClass = 'bg-purple'; // CGT

            if (info.def) html += `<div class="section"><span class="section-label ${labelClass}">ğŸ’¡ æ ¸å¿ƒå®šä¹‰</span><div class="section-content">${info.def}</div></div>`;
            
            if (info.rule) html += `<div class="section"><span class="section-label ${labelClass}">ğŸ“ è€ƒç‚¹ (FA24)</span><div class="section-content formula-box">${info.rule}</div></div>`;
            
            if (info.case) html += `<div class="section"><span class="section-label ${labelClass}">ğŸ“ æ¡ˆä¾‹</span><div class="section-content case-box">${info.case}</div></div>`;
            
            if (info.tip) html += `<div class="section"><span class="section-label ${labelClass}">âš ï¸ é¿å‘æŒ‡å—</span><div class="section-content warning-box">${info.tip}</div></div>`;

            contentDom.innerHTML = html;
            
            panel.classList.add('active');
        }

        function closePanel() {
            panel.classList.remove('active');
        }
        
        // åˆå§‹å¾®åŠ¨æ•ˆ
        setTimeout(() => {
            myChart.dispatchAction({
                type: 'highlight',
                seriesIndex: 0,
                dataIndex: 0
            });
            setTimeout(() => {
                myChart.dispatchAction({ type: 'downplay' });
            }, 2500);
        }, 800);

    </script>
</body>
</html>

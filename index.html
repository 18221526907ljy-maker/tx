<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACCA TX (UK) FA2024 Ultimate Notes (Full Content)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        /* === 1. åŸºç¡€è®¾ç½® (è«å…°è¿ªÂ·æ™šéœä¸»é¢˜) === */
        :root {
            /* è«å…°è¿ªè‰²ç›˜ */
            --col-purple: #a29bfe;   /* CGTä¸»è‰² */
            --col-purple-lt: #dcd6f7;
            --col-green: #95e1d3;    /* IHTä¸»è‰² */
            --col-green-lt: #a8e6cf;
            --col-root: #34495e;
            --col-boss: #ffb7b2;     /* çŠç‘šç²‰ BOSS */
            
            --bg-color: #fdfbf7;     /* æš–ç±³ç™½èƒŒæ™¯ */
            --text-main: #2d3436;
            --text-sub: #636e72;
            --glass: rgba(255, 255, 255, 0.98);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; overflow: hidden; background-color: var(--bg-color); font-family: "Gill Sans", "Segoe UI", sans-serif; }
        #main { width: 100vw; height: 100vh; z-index: 1; }

        /* é¡¶éƒ¨æ  */
        .header {
            position: fixed; top: 0; left: 0; right: 0; height: 50px;
            background: rgba(253, 251, 247, 0.85); backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 10;
            display: flex; align-items: center; justify-content: center;
        }
        .header h1 { font-size: 16px; color: var(--text-main); font-weight: 800; letter-spacing: 1px; margin: 0; }

        /* === 2. è¯¦æƒ…é¢æ¿ (PC/Mobile å®Œç¾é€‚é…) === */
        .mask {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(45, 52, 54, 0.2); z-index: 99; 
            display: none; opacity: 0; transition: opacity 0.3s;
        }
        .mask.active { display: block; opacity: 1; }

        .sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--glass); z-index: 100;
            box-shadow: 0 -10px 60px rgba(0,0,0,0.1);
            border-radius: 24px 24px 0 0;
            display: flex; flex-direction: column;
            transform: translateY(110%); 
            transition: transform 0.35s cubic-bezier(0.19, 1, 0.22, 1);
            
            /* ğŸ“± ç§»åŠ¨ç«¯é»˜è®¤é«˜åº¦ */
            max-height: 85vh; 
        }

        /* ğŸ’» ç”µè„‘ç«¯é€‚é…ï¼šé™åˆ¶å®½åº¦ï¼Œå±…ä¸­æ˜¾ç¤ºï¼Œé˜²æ­¢å¤ªå®½éš¾çœ‹ */
        @media (min-width: 768px) {
            .sheet {
                left: 50%; transform: translateX(-50%) translateY(110%);
                width: 700px; /* é»„é‡‘é˜…è¯»å®½åº¦ */
                max-height: 90vh;
                border: 1px solid #eee;
            }
            .sheet.active { transform: translateX(-50%) translateY(0); }
        }
        /* ğŸ“± ç§»åŠ¨ç«¯æ¿€æ´»çŠ¶æ€ */
        @media (max-width: 767px) {
            .sheet.active { transform: translateY(0); }
        }

        /* å¤´éƒ¨ */
        .sheet-head {
            padding: 20px 30px; border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .sheet-title { font-size: 20px; font-weight: 700; color: var(--text-main); margin: 0; display: flex; align-items: center; }
        .close-btn { font-size: 26px; color: #b2bec3; cursor: pointer; transition: color 0.2s; }
        .close-btn:hover { color: var(--col-boss); }

        /* å†…å®¹åŒº */
        .sheet-body { padding: 0 30px 40px 30px; overflow-y: auto; -webkit-overflow-scrolling: touch; flex: 1; }

        /* === 3. å†…å®¹ç»„ä»¶ (ç¬”è®°è¿˜åŸ) === */
        
        /* ç« èŠ‚æ ‡é¢˜ */
        .section-title {
            font-size: 13px; font-weight: 800; color: var(--text-main); 
            margin: 25px 0 12px 0; text-transform: uppercase; letter-spacing: 1px;
            display: flex; align-items: center;
        }
        .section-title::before { content:''; width:4px; height:14px; background:#ccc; margin-right:8px; border-radius:2px; }

        /* æ–‡æœ¬ */
        .text-content { font-size: 15px; line-height: 1.7; color: #555; text-align: justify; }
        .text-content b { color: #2c3e50; }
        .text-content ul { padding-left: 18px; margin: 8px 0; }
        .text-content li { margin-bottom: 6px; }

        /* è§„åˆ™å¡ç‰‡ */
        .rule-card {
            background: #fff; border: 1px solid #f0f0f0; border-radius: 10px;
            padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        
        /* æ¡ˆä¾‹ç›’å­ */
        .case-box {
            background: #fffbf5; border-left: 4px solid var(--col-boss); border-radius: 0 8px 8px 0;
            padding: 15px; margin-top: 20px;
        }
        .case-header { font-weight: 700; color: #d35400; font-size: 14px; margin-bottom: 8px; }
        .case-body { font-size: 14px; color: #444; white-space: pre-wrap; font-family: -apple-system, sans-serif; line-height: 1.6; }

        /* Proforma / ç®—å¼ */
        .formula-box {
            background: #f4f8fb; border: 1px solid #e1eef6; color: #2980b9;
            padding: 10px; border-radius: 6px; font-family: "Menlo", monospace; font-size: 13px; margin: 5px 0;
        }

        /* æŠ˜å è§£æ */
        details { margin-top: 10px; border-top: 1px dashed #e0e0e0; padding-top: 10px; }
        summary { font-size: 13px; font-weight: 600; color: #7f8c8d; cursor: pointer; list-style:none; display:flex; justify-content:space-between; }
        summary::after { content: 'â–¼ è§£æ'; color: #aaa; }
        details[open] summary::after { content: 'â–² æ”¶èµ·'; }
        .ans { margin-top:10px; padding:15px; background:#f9f9f9; border-radius:6px; font-family:monospace; font-size:13px; line-height:1.6; white-space: pre-wrap; color: #333; }

        /* è¡¨æ ¼ */
        .tax-table { width: 100%; border-collapse: collapse; font-size: 13px; margin: 10px 0; background:#fff; }
        .tax-table th { background: #f4f4f4; padding: 8px; text-align: left; border:1px solid #ddd; color:#333; font-weight:700; }
        .tax-table td { border: 1px solid #ddd; padding: 8px; color:#555; vertical-align: top; }

        /* é«˜äº® */
        .hl-red { color: #e74c3c; font-weight: bold; }
        .hl-bg { background: #e8f6f3; padding: 2px 4px; border-radius: 3px; color: #16a085; font-weight: bold; }

    </style>
</head>
<body>

    <div class="header">
        <h1>TX (UK) Full Notes</h1>
    </div>

    <div id="main"></div>

    <div class="mask" id="mask" onclick="closeSheet()"></div>
    <div class="sheet" id="sheet">
        <div class="sheet-head">
            <div class="sheet-title" id="sheetTitle">Topic</div>
            <div class="close-btn" onclick="closeSheet()">Ã—</div>
        </div>
        <div class="sheet-body" id="sheetContent"></div>
    </div>

    <script type="text/javascript">
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom, null, {renderer: 'canvas'});

        // ================= é…è‰²å®šä¹‰ =================
        const c = {
            iht: '#95e1d3',    // IHT ä¸»è‰²
            iht_sub: '#dcedc1',
            cgt: '#a29bfe',    // CGT ä¸»è‰²
            cgt_sub: '#dcd6f7',
            root: '#34495e',
            boss: '#ffb7b2'
        };

        // ================= å®Œæ•´ç¬”è®°æ•°æ®åº“ (1:1 è¿˜åŸ) =================
        const data = [
            // --- Root ---
            { id: '0', name: 'ACCA TX\n(UK)', category: 'ROOT', symbolSize: 55, itemStyle: { color: c.root }, info: { def: 'FA2024 å®Œæ•´ç¬”è®° (IHT + CGT)ã€‚<br>ç‚¹å‡»åˆ†æ”¯æŸ¥çœ‹è¯¦ç»†è®²ä¹‰ã€‚' } },

            // ==================== IHT æ¨¡å— (Legacy Data) ====================
            {
                id: 'iht_1', name: 'IHT\nåŸç†', category: 'IHT', symbolSize: 40, itemStyle: { color: c.iht },
                info: {
                    title: '1. æ ¸å¿ƒæ¦‚å¿µä¸ç¨ç‡',
                    html: `
                        <div class="section-title" style="border-color:${c.iht}">å¾ç¨åŸºç¡€</div>
                        <div class="text-content">IHT åŸºäº <b>ä»·å€¼è½¬ç§» (Transfer of Value)</b>ï¼Œå³æèµ å¯¼è‡´æèµ è€…è´¢å¯Œå‡å°‘çš„é‡‘é¢ (Diminution in value)ã€‚</div>
                        <div class="section-title" style="border-color:${c.iht}">å…³é”®ç¨ç‡ (25/26)</div>
                        <div class="rule-card">
                            <b>Nil Rate Band (NRB):</b> Â£325,000<br>
                            <b>Residence NRB (RNRB):</b> Â£175,000<br>
                            <b>Death Rate:</b> 40%<br>
                            <b>Lifetime Rate:</b> 20% (Trustee) / 25% (Donor)
                        </div>
                    `
                }
            },
            {
                id: 'iht_2', name: 'Lifetime\nç”Ÿå‰è½¬ç§»', category: 'IHT', symbolSize: 35, itemStyle: { color: c.iht_sub },
                info: {
                    title: '2. ç”Ÿå‰è½¬ç§» (Lifetime Transfers)',
                    html: `
                        <div class="section-title" style="border-color:${c.iht}">A. è±å…è½¬ç§» (Exempt)</div>
                        <div class="text-content">
                            <ul>
                                <li><b>Spouse:</b> æ— é™é¢è±å…ã€‚</li>
                                <li><b>AE (å¹´å…):</b> Â£3,000 (FIFO, å¯ç»“è½¬1å¹´)ã€‚</li>
                                <li><b>Small Gifts:</b> Â£250 (æ¯äººæ¯å¹´)ã€‚</li>
                                <li><b>Marriage:</b> çˆ¶æ¯Â£5k, ç¥–çˆ¶æ¯Â£2.5k, å…¶ä»–Â£1kã€‚</li>
                            </ul>
                        </div>
                        <div class="section-title" style="border-color:${c.iht}">B. PET & CLT</div>
                        <div class="text-content">
                            <b>PET (ä¸ªäºº):</b> ç”Ÿå‰ä¸äº¤ç¨ã€‚æ´»è¿‡7å¹´å…ç¨ã€‚<br>
                            <b>CLT (ä¿¡æ‰˜):</b> ç«‹å³äº¤ç¨ 20%ã€‚7å¹´ç´¯ç§¯åŸåˆ™ã€‚
                        </div>
                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ï¼šå¯Œè±ªçš„ä¿¡æ‰˜ (CLT)</div>
                            <div class="case-body">è½¬å…¥ä¿¡æ‰˜ Â£400,000ã€‚æ­¤å‰7å¹´æ—  CLTã€‚</div>
                            <details><summary>è§£æ</summary><div class="ans">Chargeable: Â£400,000
Less NRB: (Â£325,000)
Taxable: Â£75,000
Tax @ 20% = Â£15,000</div></details>
                        </div>
                    `
                }
            },
            {
                id: 'iht_3', name: 'Death Tax\næ­»åè¿½æº¯', category: 'IHT', symbolSize: 35, itemStyle: { color: c.iht_sub },
                info: { title: '3. æ­»äº¡é¢å¤–ç¨', html: `<div class="text-content">æ­»å‰ 7 å¹´å†…çš„ PET/CLT éœ€é‡ç®—ã€‚<br><b>Taper Relief:</b> 3-7å¹´ç¨é¢æ‰“æŠ˜ (20%-80% off)ã€‚<br><b>Credit:</b> å‡å»å·²äº¤ç”Ÿå‰ç¨ã€‚</div>` }
            },
            {
                id: 'iht_boss', name: 'IHT BOSS\nç»¼åˆé¢˜', category: 'IHT', symbolSize: 45, itemStyle: { color: c.boss },
                info: {
                    isBoss: true, title: 'ğŸ‘¹ IHT ç»ˆææˆ˜ï¼šNRB è€—å°½',
                    scen: 'Mr. Bond (2026æ­»)ã€‚\n1. 2019 CLT Â£280k\n2. 2021 PET Â£150k\n3. Estate Â£800k (æˆ¿ç»™å„¿)ã€‚',
                    ans: '1. CLTå Â£280kã€‚å‰©45kã€‚\n2. PETåƒæ‰45kå¹¶æº¢å‡ºã€‚\n3. æ­»æ—¶NRB=0ã€‚\n4. Tax=(Â£775k-Â£175k)*40% = Â£240kã€‚'
                }
            },

            // ==================== CGT æ¨¡å— (Full Content) ====================
            {
                id: 'cgt_1', name: 'CGT\næ ¸å¿ƒæ¦‚å¿µ', category: 'CGT', symbolSize: 40, itemStyle: { color: c.cgt },
                info: {
                    title: '1. æ ¸å¿ƒæ¦‚å¿µä¸ç¨ç‡ (Basic Principles)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">å¾ç¨åŸºç¡€</div>
                        <div class="text-content">å¾ç¨å¯¹è±¡ï¼šä¸ªäººåœ¨çº³ç¨å¹´åº¦å†…å¤„ç½®èµ„äº§äº§ç”Ÿçš„ <b>åˆ©å¾— (Profit)</b>ã€‚<br>è®¡ç®—åŸºç¡€ï¼šåŸºäº <b>Taxable Income</b>ã€‚CGT æ˜¯â€œé¡¶â€åœ¨ Income Tax ä¹‹ä¸Šçš„ã€‚</div>

                        <div class="section-title" style="border-color:${c.cgt}">å…³é”®ç¨ç‡ (2025/26)</div>
                        <div class="rule-card">
                            <div class="text-content">
                                <ul>
                                    <li><b>å¹´åº¦è±å… (AEA):</b> <span class="hl-red">Â£3,000</span> (ç™½ç»™ï¼Œä¸äº¤ç¨)ã€‚</li>
                                    <li><b>æ™®é€šèµ„äº§ (Normal):</b><br>- Basic Band: 10%<br>- Higher/Add Band: 20%</li>
                                    <li><b>ä½å®…æˆ¿äº§ (Residential):</b><br>- Basic Band: 18%<br>- Higher/Add Band: <span class="hl-red">24%</span> (FA24æ–°è§„)ã€‚</li>
                                    <li><b>BADR / Investors' Relief:</b> æ— è®ºæ”¶å…¥å¤šå°‘ï¼Œä¸€å¾‹ 10%ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    `
                }
            },
            {
                id: 'cgt_2', name: '2. Compute\nè®¡ç®—æ¡†æ¶', category: 'CGT', symbolSize: 35, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '2. åŸºç¡€è®¡ç®—æ¡†æ¶ (Computation)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">A. è®¡ç®—æ¨¡æ¿ (Proforma)</div>
                        <div class="proforma">Gross Proceeds (å”®ä»·/MV)
(Less: Incidental costs - é”€å”®è´¹ç”¨)
= Net Proceeds
(Less: Allowable Cost - ä¹°å…¥ä»·+è´¹ç”¨)
(Less: Enhancement Exp - å¢å€¼æ”¯å‡º)
= Chargeable Gain</div>

                        <div class="section-title" style="border-color:${c.cgt}">B. æ±‡æ€»ä¸çº³ç¨ (Tax Liability)</div>
                        <div class="text-content">
                            1. æ±‡æ€»æ‰€æœ‰ Gainsã€‚<br>
                            2. <b>å‡å» CY Losses (å½“å¹´äºæŸ):</b> å¿…é¡»å…¨é¢æŠµæ‰£ï¼Œä¸èƒ½ä¿ç•™ã€‚<br>
                            3. <b>å‡å» BF Losses (ç»“è½¬äºæŸ):</b> åªå‡åˆ° Net Gains = AEA (Â£3,000) ä¸ºæ­¢ï¼Œå‰©ä¸‹çš„ç»§ç»­ç»“è½¬ (ä¸è¦æµªè´¹ AEA)ã€‚<br>
                            4. <b>å‡å» AEA:</b> æ€»æ˜¯ä¼˜å…ˆæŠµæ‰£ç¨ç‡æœ€é«˜çš„ (å¦‚æˆ¿äº§ 24%)ã€‚<br>
                            5. <b>è®¡ç®—ç¨é¢:</b> æ ¹æ® Income Tax å‰©ä½™ Band åˆ†æ®µè®¡ç®—ã€‚
                        </div>

                        <div class="case-box">
                            <div class="case-header">ğŸŒ° æ¡ˆä¾‹ 1ï¼šæ™®é€šèµ„äº§ vs æˆ¿äº§</div>
                            <div class="case-body">Jack (Higher Rate) å–ç”»èµš Â£10kï¼Œå–æˆ¿èµš Â£20kã€‚æ— äºæŸã€‚</div>
                            <details>
                                <summary>æŸ¥çœ‹è§£æ</summary>
                                <div class="ans">1. Taxable Gains:
(Â£10k + Â£20k) - Â£3,000 (AEA) = Â£27,000
AEA ä¼˜å…ˆæŠµæ‰£æˆ¿äº§ (24% > 20%)ã€‚

2. Tax Payable:
ç”»: Â£10,000 x 20% = Â£2,000
æˆ¿: (Â£20,000 - Â£3,000) x 24% = Â£4,080

<b>Total = Â£6,080</b></div>
                            </details>
                        </div>
                    `
                }
            },
            {
                id: 'cgt_3', name: '3. Assets\nç‰¹æ®Šèµ„äº§', category: 'CGT', symbolSize: 35, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '3. ç‰¹æ®Šèµ„äº§è§„åˆ™ (Specific Assets)',
                    html: `
                        <div class="section-title" style="border-color:${c.cgt}">A. å…³è”æ–¹ & é…å¶</div>
                        <div class="text-content">
                            <b>Connected Persons:</b> å¿…é¡»ç”¨ Market Value æ›¿ä»£å®é™…å”®ä»·ã€‚äºæŸåªèƒ½æŠµæ‰£åŒä¸€ä¸ªäººã€‚<br>
                            <b>Spouse:</b> No Gain / No Lossã€‚å—èµ äººç»§æ‰¿åŸå§‹æˆæœ¬ã€‚
                        </div>

                        <div class="section-title" style="border-color:${c.cgt}">B. éƒ¨åˆ†å¤„ç½® (Part Disposal)</div>
                        <div class="formula-box">Cost = Original Cost Ã— A / (A + B)
(A=Proceeds, B=MV of Remainder)</div>

                        <div class="section-title" style="border-color:${c.cgt}">C. åŠ¨äº§ (Chattels) - Â£6k è§„åˆ™</div>
                        <div class="text-content">
                            <ul>
                                <li><b>Wasting (<50yr):</b> Exemptã€‚</li>
                                <li><b>Non-wasting (>50yr):</b>
                                    <br>- ä¹°å– < Â£6k: Exemptã€‚
                                    <br>- ä¹°å– > Â£6k: Normalã€‚
                                    <br>- ä¹° < 6k, å– > 6k: <b>Marginal Relief</b>ã€‚Gain é™åˆ¶ä¸º 5/3 Ã— (Proceeds - 6,000)ã€‚
                                    <br>- å– < 6k: Deemed Proceeds = Â£6k (é€ Loss)ã€‚
                                </li>
                            </ul>
                        </div>

                        <div class="section-title" style="border-color:${c.cgt}">D. è‚¡ç¥¨ (Shares)</div>
                        <div class="text-content">
                            <b>åŒ¹é…è§„åˆ™:</b> 1. Same Day -> 2. Next 30 Days -> 3. Share Pool (Avg Cost)ã€‚<br>
                            <b>Bonus Issue:</b> No cost, increase num.<br>
                            <b>Rights Issue:</b> Cost increases, num increases.
                        </div>
                        <div class="proforma">Share Pool Table:
| | No. | Cost (Â£) |
| Balance b/f | X | X |
| (+) Purchase | X | X |
| (-) Disposal | (X) | (X) (Avg) |</div>
                    `
                }
            },
            {
                id: 'cgt_4', name: '4. Reliefs\næ ¸å¿ƒå‡å…', category: 'CGT', symbolSize: 35, itemStyle: { color: c.cgt_sub },
                info: {
                    title: '4. æ ¸å¿ƒå‡å… (Reliefs)',
                    html: `
                        <table class="tax-table">
                            <tr><th>Relief</th><th>Effect</th><th>Conditions</th></tr>
                            <tr><td><b>BADR</b></td><td>10% Rate<br>Â£1m Limit</td><td>1. å–ç”Ÿæ„(Sole/Partner >2yr)<br>2. å–è‚¡ä»½(5%+Emp >2yr)</td></tr>
                            <tr><td><b>Investors</b></td><td>10% Rate<br>Â£10m Limit</td><td>æœªä¸Šå¸‚äº¤æ˜“å…¬å¸; æ–°è‚¡; >3å¹´; éå‘˜å·¥ã€‚</td></tr>
                            <tr><td><b>Rollover</b></td><td>Defer Gain</td><td>å–æ—§ä¹°æ–° (Qualifying Assets)<br>çª—å£: -1yr ~ +3yr</td></tr>
                            <tr><td><b>Gift</b></td><td>Defer to Donee</td><td>å•†ä¸šèµ„äº§; è”åˆç”³è¯·ã€‚</td></tr>
                            <tr><td><b>PPR</b></td><td>Exempt</td><td>è‡ªä½æˆ¿; Last 9mo deemedã€‚</td></tr>
                        </table>
                    `
                }
            },
            {
                id: 'cgt_boss', name: 'CGT BOSS\nç»¼åˆå¤§é¢˜', category: 'CGT', symbolSize: 45, itemStyle: { color: c.boss },
                info: {
                    title: 'ğŸ‘¹ ç»ˆæ BOSS æˆ˜',
                    html: `
                        <div class="case-box" style="border-color:${c.boss}; background:#fffbf0;">
                            <div class="case-header" style="color:#e67e22">Mr. Lucky ç»¼åˆé¢˜</div>
                            <div class="case-body"><b>èƒŒæ™¯ï¼š</b> Mr. Lucky (Higher Rate) 2025/26 æ“ä½œï¼š<br>1. å–å¤è‘£èŠ±ç“¶: å– Â£8,000, ä¹° Â£4,000ã€‚<br>2. å–å’–å•¡åº—: èµš Â£200,000 (ç¬¦åˆ BADR)ã€‚<br>3. å–è‚¡ç¥¨: 1000è‚¡ @ Â£5 (2010ä¹°500@Â£1k; 2020ä¹°1000@Â£3k)ã€‚<br>4. å…¶ä»–: BF Loss Â£500ã€‚<br><b>ä»»åŠ¡:</b> è®¡ç®—æ€» CGTã€‚</div>
                            
                            <details open>
                                <summary>æŸ¥çœ‹è¯¦ç»†è§£æ</summary>
                                <div class="ans"><b>Step 1: å¤è‘£èŠ±ç“¶ (Chattel)</b>
ä¹° < 6k, å– > 6k -> Marginal Relief.
Normal Gain = 8,000 - 4,000 = Â£4,000
Restricted = 5/3 Ã— (8,000 - 6,000) = Â£3,333
å–å°å€¼: <b>Chargeable Gain = Â£3,333</b>

<b>Step 2: å’–å•¡åº— (Business)</b>
Gain Â£200,000. ç¬¦åˆ BADR -> ç¨ç‡ <b>10%</b>.

<b>Step 3: è‚¡ç¥¨ (Shares)</b>
Share Pool:
Total Shares = 500 + 1000 = 1,500
Total Cost = 1,000 + 3,000 = Â£4,000
Avg Cost = 4000 / 1500 = Â£2.67 / share

Disposal Cost = 1,000 Ã— 2.67 = Â£2,667
Proceeds = 1,000 Ã— 5 = Â£5,000
Gain = 5,000 - 2,667 = <b>Â£2,333</b>

<b>Step 4: æ±‡æ€»è®¡ç®— (Tax Liability)</b>
Total Gains = 3,333 + 200,000 + 2,333 = Â£205,666
Less: BF Loss (Â£500)
Less: AEA (Â£3,000)
<b>Taxable Gains = Â£202,166</b>

<b>Tax Calculation:</b>
1. BADR (Business): Â£200,000 @ 10% = <b>Â£20,000</b>
2. Remaining (Â£2,166):
   Rate: 20% (Higher Rate, Ordinary Assets)
   Tax = 2,166 Ã— 20% = <b>Â£433</b>

<b>Total CGT Payable = Â£20,433</b></div>
                            </details>
                        </div>
                    `
                }
            }
        ];

        const links = [
            { source: '0', target: 'iht_1' }, { source: 'iht_1', target: 'iht_2' }, { source: 'iht_2', target: 'iht_3' }, { source: 'iht_3', target: 'iht_boss' },
            { source: '0', target: 'cgt_1' }, { source: 'cgt_1', target: 'cgt_2' }, { source: 'cgt_2', target: 'cgt_3' }, { source: 'cgt_3', target: 'cgt_4' }, { source: 'cgt_4', target: 'cgt_boss' }
        ];

        // ================= ECharts =================
        const option = {
            backgroundColor: 'transparent',
            series: [{
                type: 'graph',
                layout: 'force',
                data: data,
                links: links,
                roam: true,
                draggable: true,
                zoom: 0.85,
                label: { show: true, position: 'bottom', color: '#888', fontSize: 11, fontWeight: '600', formatter: '{b}', distance: 8 },
                itemStyle: { borderColor: '#fff', borderWidth: 2 },
                lineStyle: { color: '#dcdcdc', width: 1.5, curveness: 0.15, opacity: 0.6 },
                force: { repulsion: 450, edgeLength: 100, gravity: 0.06 }
            }]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());

        // ================= äº¤äº’ =================
        const mask = document.getElementById('mask');
        const sheet = document.getElementById('sheet');
        const content = document.getElementById('sheetContent');
        const titleDom = document.getElementById('sheetTitle');

        myChart.on('click', function(params) {
            if (params.data && params.data.info) openSheet(params.data);
        });

        function openSheet(node) {
            const info = node.info;
            const color = node.itemStyle.color;

            titleDom.innerText = node.name.replace('\n', ' ');
            titleDom.style.color = color;

            let html = '';
            if (info.html) {
                html = info.html;
            }

            content.innerHTML = html;
            mask.classList.add('active');
            sheet.classList.add('active');
            
            if (window.MathJax) MathJax.typesetPromise();
        }

        function closeSheet() {
            mask.classList.remove('active');
            sheet.classList.remove('active');
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ACCA TX (UK) IHT Ultimate Guide</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        /* === å…¨å±€æ ·å¼ (è«å…°è¿ªè–„è·ç»¿ä¸»é¢˜) === */
        :root {
            --primary-color: #1abc9c; /* è–„è·ç»¿ */
            --secondary-color: #16a085; /* æ·±è–„è·ç»¿ */
            --bg-color: #f4f7f6;
            --text-main: #2c3e50;
            --text-light: #7f8c8d;
            --card-bg: #ffffff;
            --accent-boss: #e67e22; /* BOSSé¢˜å¼ºè°ƒè‰² */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; overflow: hidden; background-color: var(--bg-color); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; }
        #main { width: 100vw; height: 100vh; }

        /* é¡¶éƒ¨æ  */
        .header {
            position: fixed; top: 0; left: 0; right: 0; height: 50px;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 100;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .header h1 { font-size: 16px; color: var(--primary-color); font-weight: 800; letter-spacing: 1px; margin: 0; }

        /* åº•éƒ¨è¯¦æƒ…å¼¹çª— */
        .sheet-mask {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4); z-index: 199; display: none; opacity: 0; transition: opacity 0.3s;
        }
        .sheet-mask.active { display: block; opacity: 1; }

        .sheet-container {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--card-bg); z-index: 200;
            border-top-left-radius: 20px; border-top-right-radius: 20px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
            transform: translateY(110%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex; flex-direction: column; max-height: 85vh;
        }
        .sheet-container.active { transform: translateY(0); }

        /* å¼¹çª—å¤´éƒ¨ */
        .sheet-head {
            padding: 15px 20px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
            background: #fff; border-top-left-radius: 20px; border-top-right-radius: 20px;
        }
        .sheet-title { font-size: 18px; font-weight: 800; color: var(--text-main); margin: 0; }
        .close-btn { font-size: 24px; color: #bbb; cursor: pointer; padding: 0 10px; }

        /* å¼¹çª—å†…å®¹åŒº */
        .sheet-body { padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; background: #fff; }

        /* å†…å®¹æ’ç‰ˆç»„ä»¶ */
        .block { margin-bottom: 25px; }
        .block-title { 
            font-size: 14px; font-weight: 800; color: var(--primary-color); 
            margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;
            border-left: 4px solid var(--primary-color); padding-left: 10px;
        }
        
        .text-std { font-size: 15px; line-height: 1.7; color: #555; text-align: justify; }
        .text-std strong { color: #2c3e50; font-weight: 700; }
        .text-std ul { padding-left: 18px; margin: 5px 0; }
        .text-std li { margin-bottom: 5px; }

        /* æ¡ˆä¾‹å¡ç‰‡ */
        .case-card {
            background: #f0fcf9; border: 1px solid #dbece8; border-radius: 8px;
            padding: 15px; margin-top: 15px;
        }
        .case-title { font-size: 13px; font-weight: 800; color: #16a085; margin-bottom: 8px; display: flex; align-items: center; }
        .case-title::before { content: 'ğŸŒ°'; margin-right: 5px; }
        .case-scenario { font-size: 14px; color: #555; font-style: italic; margin-bottom: 10px; border-left: 3px solid #ccc; padding-left: 8px; }
        
        /* è§£æåŒºåŸŸ */
        details { margin-top: 10px; border-top: 1px dashed #ddd; padding-top: 10px; }
        summary { font-size: 13px; font-weight: 700; color: #2980b9; cursor: pointer; list-style: none; display: flex; justify-content: space-between; }
        summary::after { content: 'æŸ¥çœ‹è§£æ â–¼'; color: #95a5a6; font-weight: normal; }
        details[open] summary::after { content: 'æ”¶èµ· â–²'; }
        
        .analysis-content { 
            background: #f4faff; padding: 12px; border-radius: 6px; margin-top: 10px;
            font-family: "Menlo", monospace; font-size: 13px; color: #2c3e50; border: 1px solid #d6eaf8; white-space: pre-wrap;
        }

        /* BOSS é¢˜ç‰¹æ®Šæ ·å¼ */
        .boss-card {
            background: #fffbf0; border: 1px solid #fcefd0; border-radius: 12px;
            padding: 0; margin-top: 15px; overflow: hidden;
        }
        .boss-header {
            background: var(--accent-boss); color: #fff; padding: 10px 15px;
            font-size: 14px; font-weight: 800; letter-spacing: 1px;
        }
        .boss-body { padding: 15px; font-size: 14px; color: #333; line-height: 1.6; }
        .boss-step { margin-top: 15px; }
        .boss-step-title { font-weight: 800; color: #d35400; font-size: 13px; margin-bottom: 5px; text-transform: uppercase; }

        /* è¡¨æ ¼æ ·å¼ */
        .tax-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; background: #fff; }
        .tax-table th, .tax-table td { border: 1px solid #bdc3c7; padding: 8px; text-align: left; }
        .tax-table th { background: #ecf0f1; color: #2c3e50; font-weight: 700; }
        .tax-table tr:nth-child(even) { background: #f9f9f9; }

    </style>
</head>
<body>

    <div class="header">
        <h1>TX (UK) IHT Ultimate Guide</h1>
    </div>

    <div id="main"></div>

    <div class="sheet-mask" id="mask" onclick="closeSheet()"></div>
    <div class="sheet-container" id="sheet">
        <div class="sheet-head">
            <h2 class="sheet-title" id="sheetTitle">Title</h2>
            <div class="close-btn" onclick="closeSheet()">Ã—</div>
        </div>
        <div class="sheet-body" id="sheetContent">
            </div>
    </div>

    <script type="text/javascript">
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);

        // ================= æ•°æ®ç»“æ„ (100% è¿˜åŸæ‚¨çš„æ–‡æœ¬) =================
        const data = [
            {
                id: 'root', name: 'IHT\né—äº§ç¨', category: 'ROOT', symbolSize: 70,
                itemStyle: { color: '#1abc9c', borderColor: '#fff', borderWidth: 3, shadowBlur: 10, shadowColor: 'rgba(26, 188, 156, 0.4)' },
                info: {
                    title: '1. æ ¸å¿ƒæ¦‚å¿µä¸åŸºç¡€ (Basic Principles)',
                    blocks: [
                        {t: 'å¾ç¨å¯¹è±¡', c: 'IHT æ˜¯åŸºäº <b>ä»·å€¼è½¬ç§» (Transfer of Value)</b>ï¼Œå³æèµ å¯¼è‡´æèµ è€…è´¢å¯Œå‡å°‘çš„é‡‘é¢ (Diminution in value)ã€‚'},
                        {t: 'çº³ç¨äººèº«ä»½', c: '<ul><li><b>UK Domiciled (è‹±å›½å±…ç±):</b> å…¨çƒèµ„äº§å¾ç¨ã€‚</li><li><b>Non-UK Domiciled (éè‹±å›½å±…ç±):</b> ä»…è‹±å›½èµ„äº§å¾ç¨ã€‚</li></ul>'},
                        {t: 'å…³é”®ç¨ç‡ä¸é¢åº¦ (2025/26)', c: '<ul><li><b>Nil Rate Band (NRB):</b> Â£325,000ã€‚</li><li><b>Residence Nil Rate Band (RNRB):</b> Â£175,000ã€‚</li><li><b>Death Rate (æ­»äº¡ç¨ç‡):</b> 40%ã€‚</li><li><b>Lifetime Rate (ç”Ÿå‰ç¨ç‡):</b> 20% (å—èµ äººä»˜) æˆ– 25% (æèµ äººä»˜)ã€‚</li></ul>'}
                    ]
                }
            },
            {
                id: 'life', name: 'Lifetime\nç”Ÿå‰è½¬ç§»', category: 'NODE', symbolSize: 50,
                itemStyle: { color: '#a8e6cf' },
                info: {
                    title: '2. ç”Ÿå‰è½¬ç§» (Lifetime Transfers)',
                    blocks: [
                        {t: 'A. è±å…è½¬ç§» (Exempt Transfers)', c: 'æ— è®ºç”Ÿå‰è¿˜æ˜¯æ­»åï¼Œæ°¸è¿œä¸å¾ç¨ã€‚<br><ul><li><b>Spouse/Civil Partner:</b> æ— é™é¢è±å…ã€‚</li><li><b>Annual Exemption (AE):</b> æ¯å¹´ Â£3,000ã€‚FIFOåŸåˆ™ï¼Œå½“å¹´æ²¡ç”¨å®Œå¯å‘åç»“è½¬ 1 å¹´ã€‚</li><li><b>Small Gifts:</b> æ¯äººæ¯å¹´ Â£250 (è‹¥è¶…è¿‡åˆ™å…¨é¢ä¸è±å…)ã€‚</li><li><b>Marriage Exemption:</b> çˆ¶æ¯ Â£5kï¼Œç¥–çˆ¶æ¯ Â£2.5kï¼Œå…¶ä»–äºº Â£1kã€‚</li><li><b>Normal expenditure:</b> ä¹ æƒ¯æ€§ä¸”ä¸å½±å“ç”Ÿæ´»æ°´å¹³ã€‚</li></ul>'},
                        {t: 'B. PET (æ½œåœ¨è±å…è½¬ç§»)', c: 'ä¸ªäººé€ç»™ä¸ªäººã€‚<br>â€¢ ç”Ÿå‰ï¼šä¸äº¤ç¨ (No immediate tax)ã€‚<br>â€¢ åæœï¼šæ´»è¿‡ 7 å¹´å®Œå…¨è±å…ï¼›7 å¹´å†…æ­»äº¡å˜æˆ Chargeableï¼Œéœ€è¡¥äº¤æ­»äº¡ç¨ã€‚'},
                        {t: 'C. CLT (åº”ç¨ç”Ÿå‰è½¬ç§»)', c: 'ä¸ªäººé€ç»™ä¿¡æ‰˜ã€‚<br>â€¢ ç”Ÿå‰ï¼šç«‹å³äº¤ç¨ã€‚<br>â€¢ è®¡ç®—ï¼š(Value - Exempt - NRB)ã€‚è¶…å‡ºéƒ¨åˆ†äº¤ 20% (Trustee) æˆ– 25% (Donor)ã€‚<br>â€¢ <b>7å¹´ç´¯ç§¯åŸåˆ™ï¼š</b>è®¡ç®—å‰©ä½™ NRB æ—¶ï¼Œæ‰£é™¤è¯¥ç¤¼ç‰©<b>ä¹‹å‰ 7 å¹´å†…</b>çš„æ‰€æœ‰ GCTã€‚<br>â€¢ åæœï¼š7 å¹´å†…æ­»äº¡é‡ç®—æ­»äº¡ç¨ã€‚'}
                    ],
                    cases: [
                        {t: 'æ¡ˆä¾‹ 1ï¼šç²¾æ‰“ç»†ç®—çš„çˆ·çˆ·', s: 'Grandpa åœ¨ 2024å¹´5æœˆé€ç»™å­™å­ Â£8,000 ç»“å©šç¤¼ç‰©ã€‚ä¸Šä¸€ç¨å¹´æœªåšèµ äºˆã€‚', a: `Transfer Value: Â£8,000
(-) Marriage Exemption: (Â£2,500) (ç¥–çˆ¶æ¯)
(-) AE (Current Year): (Â£3,000)
(-) AE (Brought Forward): (Â£2,500) (ä¸Šå¹´ç»“è½¬)
= Chargeable Value: Â£0 (å®Œå…¨è±å…)`},
                        {t: 'æ¡ˆä¾‹ 2ï¼šå¯Œè±ªçš„ä¿¡æ‰˜ (ç”Ÿå‰ç¨)', s: 'Mr. Rich å‘ä¿¡æ‰˜è½¬å…¥ Â£400,000 (CLT)ã€‚æ­¤å‰7å¹´å†…æ—  CLTï¼Œåªæœ‰ä¸€ä¸ª PET (PET ç”Ÿå‰ä¸å ç”¨ NRB)ã€‚', a: `Gross Chargeable Transfer: Â£400,000
Less NRB: (Â£325,000) (æ­¤å‰æ—  CLT)
Taxable Amount: Â£75,000
Lifetime Tax: Â£75,000 Ã— 20% = Â£15,000`}
                    ]
                }
            },
            {
                id: 'death_tax', name: 'Death Tax\næ­»åè¿½æº¯', category: 'NODE', symbolSize: 50,
                itemStyle: { color: '#a8e6cf' },
                info: {
                    title: '3. æ­»äº¡æ—¶çš„é¢å¤–ç¨ (Death Tax on Lifetime Gifts)',
                    blocks: [
                        {t: 'è§¦å‘æ¡ä»¶', c: 'æèµ äººåœ¨é€ç¤¼å 7 å¹´å†…æ­»äº¡ï¼Œä¹‹å‰çš„ PET å’Œ CLT éœ€è¦é‡ç®—ã€‚'},
                        {t: 'è®¡ç®—æ­¥éª¤', c: '1. <b>æŸ¥æ‰¾:</b> æ‰¾å‡ºæ­»å‰ 7 å¹´å†…æ‰€æœ‰ PET/CLTã€‚<br>2. <b>NRB æ‰£é™¤:</b> ä½¿ç”¨æ­»äº¡æ—¶çš„ NRB (Â£325k)ï¼Œå‡å»è¯¥ç¤¼ç‰©<b>å†å¾€å‰æ¨ 7 å¹´</b>ç´¯ç§¯çš„ GCTã€‚<br>3. <b>è®¡ç®—ç¨é¢:</b> å‰©ä½™éƒ¨åˆ† Ã— 40%ã€‚'},
                        {t: 'Taper Relief (é€’å‡å‡å…)', c: 'é€ç¤¼åæ´»å¾—å¤Ÿä¹…ï¼Œç¨é¢æ‰“æŠ˜ï¼š<br>3-4å¹´: 8æŠ˜ (20% off)<br>4-5å¹´: 6æŠ˜ (40% off)<br>5-6å¹´: 4æŠ˜ (60% off)<br>6-7å¹´: 2æŠ˜ (80% off)'},
                        {t: 'Credit', c: 'å¯¹äº CLTï¼Œå‡å»ç”Ÿå‰å·²äº¤çš„ 20% ç¨ã€‚'}
                    ],
                    cases: [
                        {t: 'æ¡ˆä¾‹ 3ï¼šä¸å¹¸çš„å¯Œè±ª (æ­»åè¿½æº¯)', s: 'æ¥æ¡ˆä¾‹2ï¼ŒMr. Rich åœ¨é€å‡º Â£100,000 PET çš„ 4.5 å¹´åå»ä¸–ã€‚', a: `Gross Value: Â£100,000
Available NRB: Â£325,000 (è¯¥ PET å‰ 7 å¹´æ— ç¤¼ç‰©)
Tax Payable: Â£0
(åœ¨ NRB å†…ï¼Œä½†åƒæ‰äº† Â£100k é¢åº¦ï¼Œå½±å“åç»­è®¡ç®—)`}
                    ]
                }
            },
            {
                id: 'estate', name: 'Estate\næ­»äº¡é—äº§', category: 'NODE', symbolSize: 50,
                itemStyle: { color: '#a8e6cf' },
                info: {
                    title: '4. æ­»äº¡é—äº§ç¨ (Death Estate)',
                    blocks: [
                        {t: 'A. é—äº§ä¼°å€¼ (Valuation)', c: 'èµ„äº§æŒ‰å¸‚ä»· (Market/Probate Value)ã€‚<br>â€¢ æ‰£é™¤: å€ºåŠ¡ã€æœªä»˜ç¨æ¬¾ã€ä¸§è‘¬è´¹ã€‚<br>â€¢ è±å…: ç•™ç»™é…å¶å®Œå…¨å…ç¨ã€‚'},
                        {t: 'B. RNRB (å±…ä½é›¶ç¨ç‡å¸¦)', c: '<b>é‡‘é¢:</b> Â£175,000ã€‚<br><b>æ¡ä»¶:</b> åŒ…å«ä¸»å±…æ‰€ (Main Residence) + ç•™ç»™ç›´ç³»åä»£ (Direct Descendants)ã€‚<br><b>æ³¨æ„:</b> æˆ¿äº§å‡€å€¼ < Â£175k æ—¶é™åˆ¶ä¸ºæˆ¿äº§å‡€å€¼ã€‚'},
                        {t: 'C. NRB è½¬ç§»', c: 'é…å¶æœªç”¨å®Œçš„ NRB/RNRB ç™¾åˆ†æ¯”å¯è½¬ç§»ã€‚'}
                    ],
                    cases: [
                        {t: 'æ¡ˆä¾‹ 4ï¼šæœ€åçš„é—äº§', s: 'Mrs. White å»ä¸–ï¼Œç•™ç»™å­™å­ä¸€å¥—æˆ¿ (Â£400k) å’Œå…¶ä»–èµ„äº§ (Â£200k)ã€‚æ— ç”Ÿå‰èµ äºˆã€‚', a: `Chargeable Estate: Â£600,000
Less RNRB: (Â£175,000) (ç¬¦åˆæ¡ä»¶)
Less NRB: (Â£325,000)
Taxable: Â£100,000
Tax: Â£100,000 Ã— 40% = Â£40,000`}
                    ]
                }
            },
            {
                id: 'proforma', name: 'Proforma\nè®¡ç®—æ¨¡æ¿', category: 'NODE', symbolSize: 50,
                itemStyle: { color: '#a8e6cf' },
                info: {
                    title: '5. å¿…èƒŒè®¡ç®—æ¨¡æ¿ (Proforma)',
                    blocks: [
                        {t: 'Step 1: Lifetime Tax (ç”Ÿå‰ç¨ - ä»… CLT)', c: '<div class="analysis-content">Transfer Value\n(Less: Exemptions - AE, Marriage)\n= Chargeable Transfer\n(Less: Available NRB - look back 7 years)\n= Taxable Amount x 20% (Trustee) / 25% (Donor)</div>'},
                        {t: 'Step 2: Death Tax on Lifetime Gifts', c: '<div class="analysis-content">Gross Chargeable Value (Value at date of gift)\n(Less: NRB at death - look back 7 yrs from gift)\n= Taxable x 40%\n(Less: Taper Relief)\n(Less: Lifetime tax paid - only for CLT)</div>'},
                        {t: 'Step 3: Death Estate (é—äº§ç¨)', c: '<div class="analysis-content">Total Assets (Probate Value)\n(Less: Debts & Funeral)\n(Less: Exempt Legacies to Spouse)\n= Chargeable Estate\n(Less: RNRB - max Â£175k)\n(Less: Remaining NRB - Â£325k minus GCTs in last 7 yrs)\n= Taxable Estate x 40%</div>'}
                    ]
                }
            },
            {
                id: 'boss', name: 'BOSS\nç»¼åˆå¤§é¢˜', category: 'BOSS', symbolSize: 60,
                itemStyle: { color: '#ffd3b6', borderColor: '#fff', borderWidth: 2, shadowBlur: 15, shadowColor: '#e67e22' },
                info: {
                    title: 'ğŸ‘¹ ç»ˆæ BOSS æˆ˜ï¼šç»¼åˆå¤§é¢˜',
                    isBoss: true,
                    scen: 'Mr. Bond (UK Domiciled) äº 2026å¹´3æœˆ20æ—¥ å»ä¸–ã€‚\n\n1. 2019å¹´8æœˆ1æ—¥ (CLT): å‘ä¿¡æ‰˜è½¬å…¥ Â£280,000 (Gross)ã€‚\n2. 2021å¹´10æœˆ1æ—¥ (PET): é€ç»™å¥³å„¿ Â£150,000ã€‚\n3. æ­»äº¡é—äº§ (Death Estate): è‡ªä½æˆ¿å±‹ Â£500,000 (ç»™å„¿å­)ï¼Œè‚¡ç¥¨ Â£300,000ï¼Œå€ºåŠ¡ Â£20,000ï¼Œä¸§è‘¬è´¹ Â£5,000ã€‚',
                    steps: [
                        {t: 'ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥ç”Ÿå‰èµ äºˆå¯¹ NRB çš„å ç”¨', c: 'CLT (2019å¹´8æœˆ): Â£280,000ã€‚<br>è·ç¦»æ­»äº¡ 6-7 å¹´ï¼Œå ç”¨ NRBã€‚<br><br>PET (2021å¹´10æœˆ): Â£150,000ã€‚<br>è·ç¦»æ­»äº¡ < 7 å¹´ï¼Œå˜æˆ Chargeableï¼Œå ç”¨ NRBã€‚<br><br><b>NRB å ç”¨è®¡ç®—:</b><br>CLT ç”¨æ‰äº†ï¼šÂ£280,000<br>å‰©ä½™ NRBï¼š325k - 280k = Â£45,000<br>PET ç”¨æ‰äº†ï¼šÂ£150,000 (åƒæ‰äº†å‰©ä¸‹çš„ Â£45kï¼Œå¹¶æº¢å‡º)ã€‚<br><b>ç»“è®ºï¼šNRB å·²å½’é›¶ã€‚</b>'},
                        {t: 'ç¬¬äºŒæ­¥ï¼šè®¡ç®—é—äº§ç¨ (Death Estate Tax)', c: `<table class="tax-table">
<tr><th>é¡¹ç›®</th><th>é‡‘é¢ (Â£)</th><th>è¯´æ˜</th></tr>
<tr><td>Total Assets</td><td>800,000</td><td>(Â£500k æˆ¿ + Â£300k è‚¡)</td></tr>
<tr><td>Less: Liabilities</td><td>(25,000)</td><td>(Â£20k å€º + Â£5k ä¸§è‘¬)</td></tr>
<tr><td><b>Net Chargeable Estate</b></td><td><b>775,000</b></td><td></td></tr>
<tr><td>Less: RNRB</td><td>(175,000)</td><td>æœ‰è‡ªä½æˆ¿ä¸”ç•™ç»™å„¿å­ï¼Œå…¨é¢æ‰£é™¤</td></tr>
<tr><td>Less: Remaining NRB</td><td>(0)</td><td><b>æ ¸å¿ƒè€ƒç‚¹ï¼š</b>ç”Ÿå‰ç¤¼ç‰©å·²è€—å°½</td></tr>
<tr><td><b>Taxable Estate</b></td><td><b>600,000</b></td><td></td></tr>
<tr><td><b>Tax Payable</b></td><td><b>240,000</b></td><td>Â£600,000 Ã— 40%</td></tr>
</table>`}
                    ]
                }
            }
        ];

        // è¿çº¿å…³ç³»
        const links = [
            { source: 'root', target: 'life' },
            { source: 'life', target: 'death_gift' }, // é€»è¾‘æµï¼šç”Ÿå‰ -> æ­»åè¿½æº¯
            { source: 'death_gift', target: 'estate' }, // -> é—äº§
            { source: 'estate', target: 'proforma' }, // -> æ¨¡æ¿
            { source: 'estate', target: 'boss' } // -> ç»¼åˆé¢˜
        ];

        // ================= ECharts é…ç½® =================
        const option = {
            backgroundColor: 'transparent',
            series: [{
                type: 'graph',
                layout: 'force',
                data: data,
                links: links,
                roam: true,
                draggable: true,
                zoom: 0.9,
                label: {
                    show: true,
                    position: 'bottom',
                    color: '#7f8c8d',
                    fontSize: 11,
                    fontWeight: 600,
                    formatter: '{b}',
                    distance: 8
                },
                lineStyle: {
                    color: '#dcdcdc',
                    curveness: 0.2,
                    width: 1.5,
                    opacity: 0.8
                },
                force: {
                    repulsion: 350,
                    edgeLength: 100,
                    gravity: 0.06
                }
            }]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());

        // ================= äº¤äº’é€»è¾‘ =================
        const mask = document.getElementById('mask');
        const sheet = document.getElementById('sheet');
        const title = document.getElementById('sheetTitle');
        const content = document.getElementById('sheetContent');

        myChart.on('click', function(params) {
            if (params.data && params.data.info) {
                openSheet(params.data);
            }
        });

        function openSheet(node) {
            const info = node.info;
            const color = node.itemStyle.color;

            title.innerText = info.title;
            title.style.color = (node.id === 'boss') ? '#e67e22' : '#1abc9c';

            let html = '';

            // BOSS é¢˜ç‰¹æ®Šæ¸²æŸ“
            if (info.isBoss) {
                html += `<div class="boss-card">
                            <div class="boss-header">ğŸ”¥ ${info.title}</div>
                            <div class="boss-body"><b>èƒŒæ™¯:</b><br>${info.scen.replace(/\n/g, '<br>')}</div>
                         </div>`;
                info.steps.forEach(step => {
                    html += `<div class="block" style="margin-top:15px">
                                <div class="block-title" style="border-color:#e67e22; color:#e67e22">${step.t}</div>
                                <div class="text-std">${step.c}</div>
                             </div>`;
                });
            } 
            // æ™®é€šèŠ‚ç‚¹æ¸²æŸ“
            else {
                if (info.blocks) {
                    info.blocks.forEach(b => {
                        html += `<div class="block">
                                    <div class="block-title">${b.t}</div>
                                    <div class="text-std">${b.c}</div>
                                 </div>`;
                    });
                }
                if (info.cases) {
                    info.cases.forEach(c => {
                        html += `<div class="case-card">
                                    <div class="case-title">${c.t}</div>
                                    <div class="case-scenario">${c.s.replace(/\n/g, '<br>')}</div>
                                    <details>
                                        <summary></summary>
                                        <div class="analysis-content">${c.a}</div>
                                    </details>
                                 </div>`;
                });
            }
            }

            content.innerHTML = html;
            mask.classList.add('active');
            sheet.classList.add('active');
        }

        function closeSheet() {
            mask.classList.remove('active');
            sheet.classList.remove('active');
        }
    </script>
</body>
</html>
